import{r as S,a0 as ae,a1 as re,o as fe,a4 as h,a5 as F,h as e,a7 as a,ad as p,V as L,ao as B,aa as t,aq as ue,ar as le,al as w,G as ge,ai as u,as as ne,ab as q,aj as de,c as z,a3 as _e,i as Ve,at as be,_ as he,a2 as xe,ag as we,a8 as K,ah as x,ac as Q,au as X,a9 as Z,am as ye,an as De,a6 as P,ap as Me,ae as Ue,J as ke}from"./index-fa1a0a70.js";import{c as ie,a as U,u as me,d as y,e as Se}from"./index.esm-b4ba26f8.js";import{v as te,V as Ce,b as $e,a as Ae,c as Fe}from"./index-c4069ffc.js";import{d as Be}from"./index-48e13c99.js";import{v as Ie}from"./vue-the-mask-0ebda96b.js";import{V as ce}from"./VForm-a77da8c3.js";import{V as E}from"./VRow-a4ddde0f.js";import{V as _}from"./VCol-1420d651.js";import{V as ee,a as qe}from"./VSelect-a23f0010.js";import{V as ze}from"./VDatePicker-4f4daa7a.js";import{_ as Ee}from"./AppointTable-fbec97bf.js";import{V as Te}from"./VContainer-17c4b5bd.js";import{b as se,V as oe,a as Pe,c as N}from"./VList-24642885.js";import{V as Ne}from"./VSheet-0025b386.js";import"./VDataTable-1e3b7ff8.js";const Le=u("div",{class:"text-h6 mx-2 my-3"},"編輯使用者資料",-1),je={class:"text-end"},Re={__name:"EditUserDialog",setup(I){const m=S(!1),V=ae(),T=re(),{apiAuth:D}=de(),$=()=>{m.value=!0},n=ie({user_name:U().required("必填"),honorific:U().required("必填"),national_id:U().required("必填").test("isNI","身分證格式錯誤",c=>Be.isNationalIdentificationNumberValid(c)),email:U().required("必填").test("isEmail","信箱格式錯誤",c=>te.isEmail(c)),phone:U().required("必填").test("isPhone","手機號碼格式錯誤",c=>(c=c.replace(/-/g,""),te.isMobilePhone(c,"zh-TW"))),address:U()}),{handleSubmit:b,isSubmitting:k}=me({validationSchema:n}),C=y("user_name"),d=y("honorific"),r=y("national_id"),o=y("email"),f=y("phone"),A=y("address");fe(()=>{C.value.value=V.user_name,d.value.value=V.honorific,r.value.value=V.national_id,o.value.value=V.email,f.value.value=V.phone,A.value.value=V.address});const W=b(async c=>{c.phone=c.phone.replace(/-/g,""),await D.patch(`/users/${V._id}`,c),V.login(c),T({text:"更新成功",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"success",location:"bottom"}})});return(c,i)=>(h(),F(q,null,[e(L,{"append-icon":"mdi-pencil",color:"teal",variant:"tonal",onClick:$},{default:a(()=>[p("編輯 ")]),_:1}),e(ne,{modelValue:m.value,"onUpdate:modelValue":i[6]||(i[6]=v=>m.value=v),width:500},{default:a(()=>[e(B,null,{default:a(()=>[e(ce,{disabled:t(k),onSubmit:ue(t(W),["prevent"])},{default:a(()=>[e(le,null,{default:a(()=>[Le,e(E,{class:"py-3"},{default:a(()=>[e(_,{cols:"12",md:"6",class:"py-0"},{default:a(()=>[e(w,{label:"姓名",modelValue:t(C).value.value,"onUpdate:modelValue":i[0]||(i[0]=v=>t(C).value.value=v),"error-messages":t(C).errorMessage.value,color:"teal",variant:"solo-filled",flat:"",rounded:"lg"},null,8,["modelValue","error-messages"])]),_:1}),e(_,{cols:"12",md:"6",class:"py-0"},{default:a(()=>[e(ee,{label:"稱謂",items:["先生","女士"],color:"teal",variant:"solo-filled",flat:"",rounded:"lg",modelValue:t(d).value.value,"onUpdate:modelValue":i[1]||(i[1]=v=>t(d).value.value=v),"error-messages":t(d).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1})]),_:1}),e(w,{label:"身分證字號",color:"teal",variant:"solo-filled",flat:"",rounded:"lg",modelValue:t(r).value.value,"onUpdate:modelValue":i[2]||(i[2]=v=>t(r).value.value=v),"error-messages":t(r).errorMessage.value},null,8,["modelValue","error-messages"]),e(w,{label:"電子信箱",type:"email",color:"teal",variant:"solo-filled",flat:"",rounded:"lg",modelValue:t(o).value.value,"onUpdate:modelValue":i[3]||(i[3]=v=>t(o).value.value=v),"error-messages":t(o).errorMessage.value},null,8,["modelValue","error-messages"]),ge(e(w,{label:"手機號碼",type:"tel",color:"teal",variant:"solo-filled",flat:"",rounded:"lg",modelValue:t(f).value.value,"onUpdate:modelValue":i[4]||(i[4]=v=>t(f).value.value=v),"error-messages":t(f).errorMessage.value},null,8,["modelValue","error-messages"]),[[t(Ie.mask),"####-###-###"]]),e(w,{label:"住址",color:"teal",variant:"solo-filled",flat:"",rounded:"lg",modelValue:t(A).value.value,"onUpdate:modelValue":i[5]||(i[5]=v=>t(A).value.value=v),"error-messages":t(A).errorMessage.value},null,8,["modelValue","error-messages"]),u("div",je,[e(L,{type:"submit",color:"teal",class:"mb-3"},{default:a(()=>[p("儲存")]),_:1})])]),_:1})]),_:1},8,["disabled","onSubmit"])]),_:1})]),_:1},8,["modelValue"])],64))}},We=u("div",{class:"text-h6 mx-2 my-3"},"新增寵物",-1),Ye=u("div",{class:"text-subtitle-1 font-weight-medium mt-4 ms-2 mb-2"},"照片",-1),Ge={class:"text-end"},Je={__name:"AddPet",emits:["update"],setup(I,{emit:m}){const V=ae(),{apiAuth:T}=be(),D=re(),$=m,n=S(!1),b=S(null),k=S(!1),C=S(null),d=S([]),r=S([]),o=z(()=>b.value?b.value.toLocaleDateString():null),f=z(()=>{if(b.value){const M=new Date,s=new Date(b.value);let g=M.getFullYear()-s.getFullYear();const l=M.getMonth()-s.getMonth();return(l<0||l===0&&M.getDate()<s.getDate())&&g--,g}return null}),A=z(()=>{if(b.value){const M=new Date,s=new Date(b.value);let g=M.getMonth()-s.getMonth();return(g<0||g===0&&M.getDate()<s.getDate())&&(g=g+12),g}return null}),W=ie({name:U().required("姓名為必填欄位"),species:U().required("種族為必填欄位"),breed:U().required("品種為必填欄位"),gender:U().required("性別為必填欄位"),weight:Se().typeError("商品價格格式錯誤").required("體重為必填欄位")}),{handleSubmit:c,isSubmitting:i,resetForm:v}=me({validationSchema:W}),Y=y("name"),G=y("species"),J=y("breed"),O=y("gender"),H=y("weight"),ve=()=>{v(),n.value=!0},pe=c(async M=>{var s,g;try{const l=new FormData;for(const j in M)l.append(j,M[j]);d.value.length>0?l.append("image",d.value[0].file):l.append("image",null),l.append("birth",o.value),l.append("owner",V._id),l.append("chip_id",""),l.append("personality",""),await T.post("/pets",l),$("update"),D({text:"新增成功",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"success",location:"bottom"}}),n.value=!1}catch(l){const j=((g=(s=l==null?void 0:l.response)==null?void 0:s.data)==null?void 0:g.message)||"發生錯誤，請稍後再試";D({text:j,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"error",location:"bottom"}})}});return(M,s)=>{const g=_e("VueFileAgent");return h(),F(q,null,[e(L,{color:"teal",variant:"tonal",class:"mt-1","append-icon":"mdi-plus-circle-outline",onClick:ve},{default:a(()=>[p("新增寵物 ")]),_:1}),e(ne,{modelValue:n.value,"onUpdate:modelValue":s[14]||(s[14]=l=>n.value=l),width:"800",persistent:""},{default:a(()=>[e(B,null,{default:a(()=>[e(ce,{disabled:t(i),onSubmit:ue(t(pe),["prevent"])},{default:a(()=>[e(le,null,{default:a(()=>[We,e(E,null,{default:a(()=>[e(_,{cols:"12",md:"6"},{default:a(()=>[e(w,{label:"姓名",color:"teal",modelValue:t(Y).value.value,"onUpdate:modelValue":s[0]||(s[0]=l=>t(Y).value.value=l),"error-messages":t(Y).errorMessage.value},null,8,["modelValue","error-messages"]),e(w,{label:"體重",type:"string","model-value":"0",suffix:"(g)",color:"teal",modelValue:t(H).value.value,"onUpdate:modelValue":s[1]||(s[1]=l=>t(H).value.value=l),"error-messages":t(H).errorMessage.value},null,8,["modelValue","error-messages"]),Ye,e(g,{modelValue:d.value,"onUpdate:modelValue":s[2]||(s[2]=l=>d.value=l),"raw-model-value":r.value,"onUpdate:rawModelValue":s[3]||(s[3]=l=>r.value=l),"error-text":{type:"檔案格式不支援",size:"檔案超過 1MB 大小限制"},accept:"image/jpeg,image/png",ref_key:"fileAgent",ref:C,"max-size":"1MB","max-files":1,deletable:""},null,8,["modelValue","raw-model-value"])]),_:1}),e(_,{cols:"12",md:"6"},{default:a(()=>[e(ee,{label:"性別",items:["公","母"],color:"teal",modelValue:t(O).value.value,"onUpdate:modelValue":s[4]||(s[4]=l=>t(O).value.value=l),"error-messages":t(O).errorMessage.value},null,8,["modelValue","error-messages"]),e(ee,{label:"種族",items:["犬","貓","兔","鼠","鳥","兩棲","其他"],color:"teal",modelValue:t(G).value.value,"onUpdate:modelValue":s[5]||(s[5]=l=>t(G).value.value=l),"error-messages":t(G).errorMessage.value},null,8,["modelValue","error-messages"]),e(w,{label:"品種",color:"teal",modelValue:t(J).value.value,"onUpdate:modelValue":s[6]||(s[6]=l=>t(J).value.value=l),"error-messages":t(J).errorMessage.value},null,8,["modelValue","error-messages"]),e(qe,{modelValue:k.value,"onUpdate:modelValue":s[10]||(s[10]=l=>k.value=l),"close-on-content-click":!1},{activator:a(({props:l})=>[e(w,Ve({label:"出生日期","model-value":o.value,color:"teal",readonly:""},l),null,16,["model-value"])]),default:a(()=>[e(ze,{onInput:s[7]||(s[7]=l=>k.value=!1),modelValue:b.value,"onUpdate:modelValue":[s[8]||(s[8]=l=>b.value=l),s[9]||(s[9]=l=>k.value=!1)],color:"teal"},null,8,["modelValue"])]),_:1},8,["modelValue"]),e(E,null,{default:a(()=>[e(_,{cols:"6"},{default:a(()=>[e(w,{label:"年齡",modelValue:f.value,"onUpdate:modelValue":s[11]||(s[11]=l=>f.value=l),suffix:"(歲)",color:"teal",readonly:""},null,8,["modelValue"])]),_:1}),e(_,{cols:"6"},{default:a(()=>[e(w,{label:"月份",modelValue:A.value,"onUpdate:modelValue":s[12]||(s[12]=l=>A.value=l),suffix:"(月)",color:"teal",readonly:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),u("div",Ge,[e(L,{color:"teal",variant:"text",class:"me-3",onClick:s[13]||(s[13]=l=>n.value=!1)},{default:a(()=>[p("取消 ")]),_:1}),e(L,{color:"teal",loading:t(i),type:"submit"},{default:a(()=>[p("新增 ")]),_:1},8,["loading"])])]),_:1})]),_:1},8,["disabled","onSubmit"])]),_:1})]),_:1},8,["modelValue"])],64)}}};const R=I=>(ye("data-v-38818931"),I=I(),De(),I),Oe=R(()=>u("div",{class:"bg"},null,-1)),He={key:0,class:"ma-3 title"},Ke={class:"small-title"},Qe={class:"d-flex justify-space-between"},Xe={class:"d-flex flex-column flex-sm-row"},Ze={class:"small-title"},ea={class:"text-caption"},aa=R(()=>u("p",null,"體重",-1)),la={class:"text-h6"},ta=R(()=>u("p",null,"年齡",-1)),sa={class:"text-h6"},oa={class:"text-h6"},ra=R(()=>u("p",null,"出生日期",-1)),ua={class:"text-h6"},na={__name:"AccountView",setup(I){const m=ae(),{api:V}=de(),{smAndUp:T}=xe(),D=S(0),$=S([]),n=z(()=>T.value),b=z(()=>`https://source.boringavatars.com/beam/120/${encodeURIComponent(m.user_name)}?colors=545454,7B8A84,B2DFDB,EDE7D5,B7CC18`),k=async()=>{m.address||(m.address="尚未填寫");try{const{data:d}=await V.get(`/pets/owner/${m._id}`);if(!d.result)return;d.result.forEach(r=>{r.birth=new Date(r.birth).toLocaleDateString("zh-TW"),r.age=new Date().getFullYear()-new Date(r.birth).getFullYear(),r.month=new Date().getMonth()-new Date(r.birth).getMonth(),(r.month<0||r.month===0&&new Date().getDate()<new Date(r.birth).getDate())&&(r.age-=1,r.month+=12)}),$.value=d.result}catch(d){console.log(d)}};k();const C=z(()=>[{icon:"mdi-phone",text:m.phone},{icon:"mdi-card-account-details",text:m.national_id},{icon:"mdi-map-marker",text:m.address},{icon:"mdi-email",text:m.email}]);return(d,r)=>(h(),F(q,null,[Oe,e(Te,{style:we(n.value?"margin-top: -11vh;":"margin-top: -20vh;")},{default:a(()=>[e(E,null,{default:a(()=>[e(_,{cols:"12",md:"10","offset-md":"1"},{default:a(()=>[n.value?K("",!0):(h(),F("div",He,"個人帳號")),e(B,{class:"px-4 py-2"},{default:a(()=>[e(se,{class:"pb-0"},{default:a(()=>[e(oe,{"prepend-avatar":b.value,class:"pe-0"},{append:a(()=>[e(Re)]),default:a(()=>[e(Pe,null,{default:a(()=>[p(x(t(m).user_name)+" ",1),u("span",Ke," ("+x(t(m).honorific)+")",1)]),_:1})]),_:1},8,["prepend-avatar"])]),_:1}),e(N,{class:"my-1"}),u("div",null,[e(se,{class:"pa-0 d-flex flex-column flex-md-row justify-md-space-between overflow-hidden",disabled:""},{default:a(()=>[(h(!0),F(q,null,Q(C.value,o=>(h(),P(oe,{key:o,"prepend-icon":o.icon},{default:a(()=>[p(x(o.text),1)]),_:2},1032,["prepend-icon"]))),128))]),_:1})])]),_:1})]),_:1}),e(_,{cols:"12",md:"10","offset-md":"1"},{default:a(()=>[e(B,{class:"pa-3"},{default:a(()=>[u("div",Qe,[e(X,{class:"card-title"},{default:a(()=>[p("寵物資料")]),_:1}),e(Je,{onUpdate:k})]),e(N,{class:"mt-1 mb-sm-3"}),u("div",Xe,[e(E,null,{default:a(()=>[e(_,{cols:"12",sm:"2",class:Z(n.value?"":"mt-3 pb-0")},{default:a(()=>[e(Ce,{modelValue:D.value,"onUpdate:modelValue":r[0]||(r[0]=o=>D.value=o),direction:n.value?"vertical":"horizontal",color:"teal"},{default:a(()=>[(h(!0),F(q,null,Q($.value,(o,f)=>(h(),P(Ae,{key:f,value:f,class:Z(D.value===f?"tab-focus":""),rounded:n.value?"e":"t"},{default:a(()=>[p(x(o.name),1)]),_:2},1032,["value","class","rounded"]))),128))]),_:1},8,["modelValue","direction"])]),_:1},8,["class"]),e(_,{cols:"12",sm:"10",class:Z(n.value?"":"py-0")},{default:a(()=>[e($e,{modelValue:D.value,"onUpdate:modelValue":r[1]||(r[1]=o=>D.value=o),touch:""},{default:a(()=>[(h(!0),F(q,null,Q($.value,(o,f)=>(h(),P(Fe,{key:f,value:f},{default:a(()=>[e(B,{class:"pa-3 mb-3 elevation-0"},{default:a(()=>[e(X,{class:"mb-3 card-title"},{default:a(()=>[p("基本資料")]),_:1}),e(B,{class:"mx-2 mb-2",flat:""},{prepend:a(()=>[e(Me,{size:n.value?"60":"40",class:"me-2"},{default:a(()=>[e(Ue,{src:o.image,cover:""},null,8,["src"])]),_:2},1032,["size"])]),title:a(()=>[p(x(o.name),1),u("span",Ze," ("+x(o.species)+")",1)]),subtitle:a(()=>[u("p",ea,"晶片號碼："+x(o.chip_id),1)]),append:a(()=>[e(ke,{icon:o.gender==="公"?"mdi-gender-male":"mdi-gender-female",color:"teal",size:"40"},null,8,["icon"])]),_:2},1024),e(Ne,{class:"mx-2 mb-2 px-3 sheet",rounded:""},{default:a(()=>[e(le,null,{default:a(()=>[e(E,null,{default:a(()=>[e(_,{cols:"12",sm:"4"},{default:a(()=>[aa,u("span",la,x(o.weight),1),p("(g) ")]),_:2},1024),n.value?(h(),P(N,{key:0,color:"teal",vertical:""})):K("",!0),e(_,{cols:"12",sm:"4"},{default:a(()=>[ta,u("span",sa,x(o.age),1),p(" 歲 "),u("span",oa,x(o.month),1),p(" 月 ")]),_:2},1024),n.value?(h(),P(N,{key:1,color:"teal",vertical:""})):K("",!0),e(_,{cols:"12",sm:"4"},{default:a(()=>[ra,u("span",ua,x(o.birth),1)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024),e(N,{class:"my-3"}),e(B,{class:"elevation-0"},{default:a(()=>[e(X,{class:"ma-3 card-title"},{default:a(()=>[p("掛號紀錄")]),_:1}),e(Ee,{id:o._id},null,8,["id"])]),_:2},1024)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["class"])]),_:1})])]),_:1})]),_:1})]),_:1})]),_:1},8,["style"])],64))}},Da=he(na,[["__scopeId","data-v-38818931"]]);export{Da as default};
