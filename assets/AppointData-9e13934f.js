import{b8 as L,r as s,_ as N,a1 as R,a0 as T,Z as F,b7 as z,c as h,o as O,a3 as D,a5 as $,a6 as l,ar as Z,au as j,h as o,a7 as E,an as G,i as H,V as k,as as J,ab as K}from"./index-716b94b4.js";import{V as Q}from"./VForm-344175e2.js";import{V as W}from"./VRow-210547fd.js";import{V as d}from"./VCol-9539db28.js";import{a as X,V as q}from"./VSelect-86733520.js";import{V as Y}from"./VDatePicker-ec733ce0.js";import{V as ee}from"./VDataTable-5b808784.js";import{V as te}from"./VCheckbox-fec12d1e.js";import{V as ae}from"./VContainer-9b68f997.js";import"./VList-2751bc00.js";import"./VSheet-bcee0fe5.js";const oe=L("appointment",()=>{const V=s(""),n=s(""),r=s("");return{date:V,time:n,doctor:r,update:i=>{V.value=i.date,n.value=i.time,r.value=i.doctor}}},{persist:{key:"48763",paths:["token"]}});const le={__name:"AppointData",setup(V){const n=s(null),r=s(!1),u=s(null),i=s([]),c=s(null),g=s({required:e=>!!e||"此欄位為必填"}),w=s([]),y=s(!1),{sm:S}=R(),{api:m}=j(),_=T(),C=F(),p=z(),A=oe(),x=h(()=>S.value);O(async()=>{n.value=p.query.date?new Date(p.query.date):null,u.value=p.query.time||null,c.value=p.query.doctor||null;try{const{data:e}=await m.get("/admins");i.value=e.result.filter(t=>t.position==="獸醫師").map(t=>({title:t.account,subtitle:t.position,value:t._id})),await b()}catch(e){console.log(e)}});const v=h(()=>n.value?n.value.toLocaleDateString("en-CA"):null),B=[{title:"#",key:"order"},{title:"寵物",key:"pet_name"},{title:"種族",key:"pet_species"},{title:"品種",key:"pet_breed"},{title:"性格",key:"pet_personality"},{title:"已完成",key:"status",align:"center",sortable:!1},{title:"檢視",key:"view",align:"center",sortable:!1},{title:"刪除",key:"delete",align:"center",sortable:!1}],b=async()=>{try{const e={date:v.value,time:u.value,doctor:c.value};y.value=!0;const{data:t}=await m.get("/appointments",{params:e});w.value=t.result}catch(e){console.log(e)}y.value=!1},I=async()=>{var e,t;try{const a={date:v.value,time:u.value,doctor:c.value};b(),A.update(a),C.replace({query:{date:v.value,time:u.value,doctor:c.value}})}catch(a){const f=((t=(e=a==null?void 0:a.response)==null?void 0:e.data)==null?void 0:t.message)||"發生錯誤，請稍後再試";_({text:f,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"error",location:"bottom"}})}},M=async e=>{e.status?e.status=!1:e.status=!0,await m.patch(`/appointments/${e._id}`,{status:e.status});const t=e.status?`${e.pet_name} 已完成`:`${e.pet_name} 未完成`;_({text:t,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"success",location:"bottom"}})},P=e=>{C.push(`/admin/appointment/${e.pet}`)},U=async e=>{await m.delete(`/appointments/${e._id}`),_({text:"刪除成功",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"success",location:"bottom"}}),b()};return(e,t)=>(D(),$(Q,{onSubmit:Z(I,["prevent"])},{default:l(()=>[o(ae,null,{default:l(()=>[o(W,null,{default:l(()=>[x.value?E("",!0):(D(),$(d,{key:0,cols:"12",md:"1"})),o(d,{cols:"12",md:"3"},{default:l(()=>[o(X,{modelValue:r.value,"onUpdate:modelValue":t[2]||(t[2]=a=>r.value=a),"close-on-content-click":!1},{activator:l(({props:a})=>[o(G,H({label:"日期","model-value":v.value,"prepend-inner-icon":"mdi-calendar",color:"teal","bg-color":"white",readonly:"",flat:""},a),null,16,["model-value"])]),default:l(()=>[o(Y,{"onUpdate:modelValue":[t[0]||(t[0]=a=>r.value=!1),t[1]||(t[1]=a=>n.value=a)],modelValue:n.value,color:"teal"},null,8,["modelValue"])]),_:1},8,["modelValue"])]),_:1}),o(d,{cols:"12",md:"3"},{default:l(()=>[o(q,{label:"時段",modelValue:u.value,"onUpdate:modelValue":t[3]||(t[3]=a=>u.value=a),"prepend-inner-icon":"mdi-clock-time-four-outline",items:["上午診","下午診","夜間診"],color:"teal","bg-color":"white",rules:[g.value.required]},null,8,["modelValue","rules"])]),_:1}),o(d,{cols:"12",md:"3"},{default:l(()=>[o(q,{label:"獸醫師",modelValue:c.value,"onUpdate:modelValue":t[4]||(t[4]=a=>c.value=a),items:i.value,"item-props":!0,"item-title":"title","item-value":"value",color:"teal","bg-color":"white",rules:[g.value.required]},null,8,["modelValue","items","rules"])]),_:1}),o(d,{cols:"12",md:"2"},{default:l(()=>[o(k,{type:"submit","prepend-icon":"mdi-magnify",color:"teal",class:J(x.value?"":"mt-3")},{default:l(()=>[K("搜尋")]),_:1},8,["class"])]),_:1})]),_:1}),o(ee,{headers:B,items:w.value,"items-per-page":10,loading:y.value,"no-data-text":"請先選擇日期、時段、獸醫師並搜尋"},{"item.status":l(({item:a})=>[o(te,{"model-value":a.status,color:"teal","hide-details":"",onClick:f=>M(a)},null,8,["model-value","onClick"])]),"item.view":l(({item:a})=>[o(k,{icon:"mdi-eye",color:"teal",variant:"text",onClick:f=>P(a)},null,8,["onClick"])]),"item.delete":l(({item:a})=>[o(k,{icon:"mdi-delete",color:"grey",variant:"text",onClick:f=>U(a)},null,8,["onClick"])]),_:2},1032,["items","loading"])]),_:1})]),_:1}))}},Ve=N(le,[["__scopeId","data-v-d6c067ef"]]);export{Ve as default};
