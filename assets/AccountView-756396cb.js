import{r as S,$ as ee,a0 as re,o as ne,a3 as _,a4 as $,h as e,a6 as l,ab as v,V as q,ak as z,aa as t,ar as ue,al as le,an as y,G as ge,ag as n,at as de,a8 as I,aj as ie,c as L,a2 as _e,i as Ve,au as be,_ as he,a1 as xe,a7 as W,ae as ye,af as x,a9 as Q,aq as X,as as ae,ah as we,ai as De,a5 as P,ao as ke,ac as Me,J as Ue}from"./index-2e460a83.js";import{z as Se}from"./vue-boring-avatars-844f2dbc.js";import{c as me,a as M,u as ce,d as w,e as Ce}from"./index.esm-50fafb66.js";import{v as te,V as $e,b as Ae,a as Fe,c as ze}from"./index-4792dc6a.js";import{d as Be}from"./index-9f6f9598.js";import{v as Ie}from"./vue-the-mask-b7ba118e.js";import{V as ve}from"./VForm-90629cde.js";import{V as E}from"./VRow-3a265910.js";import{V}from"./VCol-26bf99c6.js";import{V as Z,a as qe}from"./VSelect-2b4db6fe.js";import{V as Ee}from"./VDatePicker-5a64514c.js";import{_ as Te}from"./AppointTable-a21bdc79.js";import{V as Pe}from"./VContainer-f793f754.js";import{b as se,V as oe,a as Ne,c as N}from"./VList-1613b161.js";import{V as Le}from"./VSheet-2473dcd5.js";import"./VDataTable-bd5d4887.js";const je=n("div",{class:"text-h6 mx-2 my-3"},"編輯使用者資料",-1),Re={class:"text-end mb-3"},We={__name:"EditUserDialog",setup(B){const i=S(!1),b=ee(),T=re(),{apiAuth:D}=ie(),A=()=>{i.value=!0},d=me({user_name:M().required("必填"),honorific:M().required("必填"),national_id:M().required("必填").test("isNI","身分證格式錯誤",f=>Be.isNationalIdentificationNumberValid(f)),email:M().required("必填").test("isEmail","信箱格式錯誤",f=>te.isEmail(f)),phone:M().required("必填").test("isPhone","手機號碼格式錯誤",f=>(f=f.replace(/-/g,""),te.isMobilePhone(f,"zh-TW"))),address:M()}),{handleSubmit:h,isSubmitting:U}=ce({validationSchema:d}),C=w("user_name"),m=w("honorific"),r=w("national_id"),o=w("email"),p=w("phone"),F=w("address");ne(()=>{C.value.value=b.user_name,m.value.value=b.honorific,r.value.value=b.national_id,o.value.value=b.email,p.value.value=b.phone,F.value.value=b.address});const Y=h(async f=>{f.phone=f.phone.replace(/-/g,""),await D.patch(`/users/${b._id}`,f),b.login(f),T({text:"更新成功",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"success",location:"bottom"}})});return(f,u)=>(_(),$(I,null,[e(q,{"append-icon":"mdi-pencil",color:"teal",variant:"tonal",rounded:"",onClick:A},{default:l(()=>[v("編輯 ")]),_:1}),e(de,{modelValue:i.value,"onUpdate:modelValue":u[7]||(u[7]=c=>i.value=c),width:500,persistent:""},{default:l(()=>[e(z,null,{default:l(()=>[e(ve,{disabled:t(U),onSubmit:ue(t(Y),["prevent"])},{default:l(()=>[e(le,null,{default:l(()=>[je,e(E,{class:"py-3"},{default:l(()=>[e(V,{cols:"12",md:"6",class:"py-0"},{default:l(()=>[e(y,{label:"姓名",modelValue:t(C).value.value,"onUpdate:modelValue":u[0]||(u[0]=c=>t(C).value.value=c),"error-messages":t(C).errorMessage.value,color:"teal",variant:"solo-filled",flat:"",rounded:"lg"},null,8,["modelValue","error-messages"])]),_:1}),e(V,{cols:"12",md:"6",class:"py-0"},{default:l(()=>[e(Z,{label:"稱謂",items:["先生","女士"],color:"teal",variant:"solo-filled",flat:"",rounded:"lg",modelValue:t(m).value.value,"onUpdate:modelValue":u[1]||(u[1]=c=>t(m).value.value=c),"error-messages":t(m).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1})]),_:1}),e(y,{label:"身分證字號",color:"teal",variant:"solo-filled",flat:"",rounded:"lg",modelValue:t(r).value.value,"onUpdate:modelValue":u[2]||(u[2]=c=>t(r).value.value=c),"error-messages":t(r).errorMessage.value},null,8,["modelValue","error-messages"]),e(y,{label:"電子信箱",type:"email",color:"teal",variant:"solo-filled",flat:"",rounded:"lg",modelValue:t(o).value.value,"onUpdate:modelValue":u[3]||(u[3]=c=>t(o).value.value=c),"error-messages":t(o).errorMessage.value},null,8,["modelValue","error-messages"]),ge(e(y,{label:"手機號碼",type:"tel",color:"teal",variant:"solo-filled",flat:"",rounded:"lg",modelValue:t(p).value.value,"onUpdate:modelValue":u[4]||(u[4]=c=>t(p).value.value=c),"error-messages":t(p).errorMessage.value},null,8,["modelValue","error-messages"]),[[t(Ie.mask),"####-###-###"]]),e(y,{label:"住址",color:"teal",variant:"solo-filled",flat:"",rounded:"lg",modelValue:t(F).value.value,"onUpdate:modelValue":u[5]||(u[5]=c=>t(F).value.value=c),"error-messages":t(F).errorMessage.value},null,8,["modelValue","error-messages"]),n("div",Re,[e(q,{color:"teal",variant:"text",class:"me-3",onClick:u[6]||(u[6]=c=>i.value=!1)},{default:l(()=>[v("取消 ")]),_:1}),e(q,{type:"submit",color:"teal"},{default:l(()=>[v("儲存")]),_:1})])]),_:1})]),_:1},8,["disabled","onSubmit"])]),_:1})]),_:1},8,["modelValue"])],64))}},Ye=n("div",{class:"text-h6 mx-2 my-3"},"新增寵物",-1),Ge=n("div",{class:"text-subtitle-1 font-weight-medium mt-4 ms-2 mb-2"},"照片",-1),Je={class:"text-end"},Oe={__name:"AddPet",emits:["update"],setup(B,{emit:i}){const b=ee(),{apiAuth:T}=be(),D=re(),A=i,d=S(!1),h=S(null),U=S(!1),C=S(null),m=S([]),r=S([]),o=L(()=>h.value?h.value.toLocaleDateString():null),p=L(()=>{if(h.value){const k=new Date,s=new Date(h.value);let g=k.getFullYear()-s.getFullYear();const a=k.getMonth()-s.getMonth();return(a<0||a===0&&k.getDate()<s.getDate())&&g--,g}return null}),F=L(()=>{if(h.value){const k=new Date,s=new Date(h.value);let g=k.getMonth()-s.getMonth();return(g<0||g===0&&k.getDate()<s.getDate())&&(g=g+12),g}return null}),Y=me({name:M().required("姓名為必填欄位"),species:M().required("種族為必填欄位"),breed:M().required("品種為必填欄位"),gender:M().required("性別為必填欄位"),weight:Ce().typeError("商品價格格式錯誤").required("體重為必填欄位")}),{handleSubmit:f,isSubmitting:u,resetForm:c}=ce({validationSchema:Y}),G=w("name"),J=w("species"),O=w("breed"),H=w("gender"),K=w("weight"),fe=()=>{c(),d.value=!0},pe=f(async k=>{var s,g;try{const a=new FormData;for(const R in k)a.append(R,k[R]);m.value.length>0?a.append("image",m.value[0].file):a.append("image",null),a.append("birth",o.value),a.append("owner",b._id),a.append("chip_id",""),a.append("personality",""),await T.post("/pets",a),A("update"),D({text:"新增成功",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"success",location:"bottom"}}),d.value=!1}catch(a){const R=((g=(s=a==null?void 0:a.response)==null?void 0:s.data)==null?void 0:g.message)||"發生錯誤，請稍後再試";D({text:R,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"error",location:"bottom"}})}});return(k,s)=>{const g=_e("VueFileAgent");return _(),$(I,null,[e(q,{color:"teal",variant:"tonal",class:"mt-1",rounded:"","append-icon":"mdi-plus-circle-outline",onClick:fe},{default:l(()=>[v("新增寵物 ")]),_:1}),e(de,{modelValue:d.value,"onUpdate:modelValue":s[14]||(s[14]=a=>d.value=a),width:"800",persistent:""},{default:l(()=>[e(z,null,{default:l(()=>[e(ve,{disabled:t(u),onSubmit:ue(t(pe),["prevent"])},{default:l(()=>[e(le,null,{default:l(()=>[Ye,e(E,null,{default:l(()=>[e(V,{cols:"12",md:"6"},{default:l(()=>[e(y,{label:"姓名",color:"teal",modelValue:t(G).value.value,"onUpdate:modelValue":s[0]||(s[0]=a=>t(G).value.value=a),"error-messages":t(G).errorMessage.value},null,8,["modelValue","error-messages"]),e(y,{label:"體重",type:"string","model-value":"0",suffix:"(g)",color:"teal",modelValue:t(K).value.value,"onUpdate:modelValue":s[1]||(s[1]=a=>t(K).value.value=a),"error-messages":t(K).errorMessage.value},null,8,["modelValue","error-messages"]),Ge,e(g,{modelValue:m.value,"onUpdate:modelValue":s[2]||(s[2]=a=>m.value=a),"raw-model-value":r.value,"onUpdate:rawModelValue":s[3]||(s[3]=a=>r.value=a),"error-text":{type:"檔案格式不支援",size:"檔案超過 1MB 大小限制"},accept:"image/jpeg,image/png",ref_key:"fileAgent",ref:C,"max-size":"1MB","max-files":1,deletable:""},null,8,["modelValue","raw-model-value"])]),_:1}),e(V,{cols:"12",md:"6"},{default:l(()=>[e(Z,{label:"性別",items:["公","母"],color:"teal",modelValue:t(H).value.value,"onUpdate:modelValue":s[4]||(s[4]=a=>t(H).value.value=a),"error-messages":t(H).errorMessage.value},null,8,["modelValue","error-messages"]),e(Z,{label:"種族",items:["犬","貓","兔","鼠","鳥","兩棲","其他"],color:"teal",modelValue:t(J).value.value,"onUpdate:modelValue":s[5]||(s[5]=a=>t(J).value.value=a),"error-messages":t(J).errorMessage.value},null,8,["modelValue","error-messages"]),e(y,{label:"品種",color:"teal",modelValue:t(O).value.value,"onUpdate:modelValue":s[6]||(s[6]=a=>t(O).value.value=a),"error-messages":t(O).errorMessage.value},null,8,["modelValue","error-messages"]),e(qe,{modelValue:U.value,"onUpdate:modelValue":s[10]||(s[10]=a=>U.value=a),"close-on-content-click":!1},{activator:l(({props:a})=>[e(y,Ve({label:"出生日期","model-value":o.value,color:"teal",readonly:""},a),null,16,["model-value"])]),default:l(()=>[e(Ee,{onInput:s[7]||(s[7]=a=>U.value=!1),modelValue:h.value,"onUpdate:modelValue":[s[8]||(s[8]=a=>h.value=a),s[9]||(s[9]=a=>U.value=!1)],color:"teal"},null,8,["modelValue"])]),_:1},8,["modelValue"]),e(E,null,{default:l(()=>[e(V,{cols:"6"},{default:l(()=>[e(y,{label:"年齡",modelValue:p.value,"onUpdate:modelValue":s[11]||(s[11]=a=>p.value=a),suffix:"(歲)",color:"teal",readonly:""},null,8,["modelValue"])]),_:1}),e(V,{cols:"6"},{default:l(()=>[e(y,{label:"月份",modelValue:F.value,"onUpdate:modelValue":s[12]||(s[12]=a=>F.value=a),suffix:"(月)",color:"teal",readonly:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),n("div",Je,[e(q,{color:"teal",variant:"text",class:"me-3",onClick:s[13]||(s[13]=a=>d.value=!1)},{default:l(()=>[v("取消 ")]),_:1}),e(q,{color:"teal",loading:t(u),type:"submit"},{default:l(()=>[v("新增 ")]),_:1},8,["loading"])])]),_:1})]),_:1},8,["disabled","onSubmit"])]),_:1})]),_:1},8,["modelValue"])],64)}}};const j=B=>(we("data-v-d8cb5ca1"),B=B(),De(),B),He={class:"overflow"},Ke={key:0,class:"image-paw"},Qe=j(()=>n("div",{class:"circle-top"},null,-1)),Xe=j(()=>n("div",{class:"circle-bottom"},null,-1)),Ze={key:0,class:"ma-3 title"},el={class:"small-title"},ll={class:"d-flex justify-space-between"},al={class:"d-flex flex-column flex-sm-row"},tl={class:"small-title"},sl={class:"text-caption"},ol=j(()=>n("p",null,"體重",-1)),rl={class:"text-h6"},nl=j(()=>n("p",null,"年齡",-1)),ul={class:"text-h6"},dl={class:"text-h6"},il=j(()=>n("p",null,"出生日期",-1)),ml={class:"text-h6"},cl={__name:"AccountView",setup(B){const i=ee(),{api:b}=ie(),{smAndUp:T}=xe(),D=S(0),A=S([]),d=L(()=>T.value),h=ne(()=>encodeURIComponent(i.user_name)),U=async()=>{i.address||(i.address="尚未填寫");try{const{data:m}=await b.get(`/pets/owner/${i._id}`);if(!m.result)return;m.result.forEach(r=>{r.birth=new Date(r.birth).toLocaleDateString("zh-TW"),r.age=new Date().getFullYear()-new Date(r.birth).getFullYear(),r.month=new Date().getMonth()-new Date(r.birth).getMonth(),(r.month<0||r.month===0&&new Date().getDate()<new Date(r.birth).getDate())&&(r.age-=1,r.month+=12)}),A.value=m.result}catch(m){console.log(m)}};U();const C=L(()=>[{icon:"mdi-phone",text:i.phone},{icon:"mdi-card-account-details",text:i.national_id},{icon:"mdi-map-marker",text:i.address},{icon:"mdi-email",text:i.email}]);return(m,r)=>(_(),$(I,null,[n("div",He,[d.value?(_(),$("div",Ke)):W("",!0),Qe,Xe]),e(Pe,{style:ye(d.value?"margin-top: 20vh;":"margin-top: 10vh;")},{default:l(()=>[e(E,null,{default:l(()=>[e(V,{cols:"12",md:"10","offset-md":"1",class:"pt-0"},{default:l(()=>[d.value?W("",!0):(_(),$("div",Ze,"個人帳號")),e(z,{class:"px-4 py-2",rounded:"lg",style:{background:"rgba(255, 255, 255, 0.8)"},flat:""},{default:l(()=>[e(se,{class:"pb-0","bg-color":"transparent"},{default:l(()=>[e(oe,{class:"pe-0"},{prepend:l(()=>[e(t(Se),{name:t(h),variant:"beam",size:d.value?"80":"60",colors:["#545454","#7B8A84","#B2DFDB","#EDE7D5","#B7CC18"]},null,8,["name","size"])]),append:l(()=>[e(We)]),default:l(()=>[e(Ne,null,{default:l(()=>[v(x(t(i).user_name)+" ",1),n("span",el," ("+x(t(i).honorific)+")",1)]),_:1})]),_:1})]),_:1}),e(N,{class:"my-1"}),n("div",null,[e(se,{class:"pa-0 d-flex flex-column flex-md-row justify-md-space-between overflow-hidden",disabled:"","bg-color":"transparent"},{default:l(()=>[(_(!0),$(I,null,Q(C.value,o=>(_(),P(oe,{key:o,"prepend-icon":o.icon},{default:l(()=>[v(x(o.text),1)]),_:2},1032,["prepend-icon"]))),128))]),_:1})])]),_:1})]),_:1}),e(V,{cols:"12",md:"10","offset-md":"1"},{default:l(()=>[e(z,{class:"pa-3",rounded:"lg",style:{background:"rgba(255, 255, 255, 0.7)"},flat:""},{default:l(()=>[n("div",ll,[e(X,{class:"card-title"},{default:l(()=>[v("寵物資料")]),_:1}),e(Oe,{onUpdate:U})]),e(N,{class:"mt-1 mb-sm-3"}),n("div",al,[e(E,null,{default:l(()=>[e(V,{cols:"12",sm:"2",class:ae(d.value?"":"mt-3 pb-0")},{default:l(()=>[e($e,{modelValue:D.value,"onUpdate:modelValue":r[0]||(r[0]=o=>D.value=o),direction:d.value?"vertical":"horizontal",color:"teal"},{default:l(()=>[(_(!0),$(I,null,Q(A.value,(o,p)=>(_(),P(Fe,{key:p,value:p,class:ae(D.value===p?"tab-focus":""),rounded:d.value?"e-lg":"t-lg"},{default:l(()=>[v(x(o.name),1)]),_:2},1032,["value","class","rounded"]))),128))]),_:1},8,["modelValue","direction"])]),_:1},8,["class"]),e(V,{cols:"12",sm:"10",class:"pb-2"},{default:l(()=>[e(Ae,{modelValue:D.value,"onUpdate:modelValue":r[1]||(r[1]=o=>D.value=o),touch:""},{default:l(()=>[(_(!0),$(I,null,Q(A.value,(o,p)=>(_(),P(ze,{key:p,value:p},{default:l(()=>[e(z,{class:"pa-0 mb-3",flat:"",style:{"background-color":"#ffffff00"}},{default:l(()=>[e(X,{class:"ma-3 card-title"},{default:l(()=>[v("基本資料")]),_:1}),e(z,{class:"mx-2 mb-2",flat:"",style:{"background-color":"#ffffff00"}},{prepend:l(()=>[e(ke,{size:d.value?"60":"40",class:"me-2"},{default:l(()=>[e(Me,{src:o.image,cover:""},null,8,["src"])]),_:2},1032,["size"])]),title:l(()=>[v(x(o.name),1),n("span",tl," ("+x(o.species)+")",1)]),subtitle:l(()=>[n("p",sl,"晶片號碼："+x(o.chip_id),1)]),append:l(()=>[e(Ue,{icon:o.gender==="公"?"mdi-gender-male":"mdi-gender-female",color:"teal",size:"40"},null,8,["icon"])]),_:2},1024),e(Le,{class:"mx-2 mb-2 px-3 sheet",rounded:""},{default:l(()=>[e(le,null,{default:l(()=>[e(E,null,{default:l(()=>[e(V,{cols:"12",sm:"4"},{default:l(()=>[ol,n("span",rl,x(o.weight),1),v("(g) ")]),_:2},1024),d.value?(_(),P(N,{key:0,color:"teal",class:"my-2",vertical:""})):W("",!0),e(V,{cols:"12",sm:"4"},{default:l(()=>[nl,n("span",ul,x(o.age),1),v(" 歲 "),n("span",dl,x(o.month),1),v(" 月 ")]),_:2},1024),d.value?(_(),P(N,{key:1,color:"teal",class:"my-2",vertical:""})):W("",!0),e(V,{cols:"12",sm:"4"},{default:l(()=>[il,n("span",ml,x(o.birth),1)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024),e(N),e(z,{class:"pa-0 mb-1",flat:"",style:{"background-color":"#ffffff00"}},{default:l(()=>[e(X,{class:"ma-3 card-title"},{default:l(()=>[v("掛號紀錄")]),_:1}),e(Te,{id:o._id},null,8,["id"])]),_:2},1024)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})])]),_:1})]),_:1})]),_:1})]),_:1},8,["style"])],64))}},Cl=he(cl,[["__scopeId","data-v-d8cb5ca1"]]);export{Cl as default};
