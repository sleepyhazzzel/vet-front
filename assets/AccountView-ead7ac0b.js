import{r as S,$ as ee,a0 as re,o as pe,a3 as _,a4 as C,h as e,a6 as a,ab as f,V as z,ak as B,aa as t,ar as ne,al as ae,an as y,G as ge,ag as n,at as ue,a8 as q,aj as de,c as E,a2 as _e,i as Ve,au as be,_ as he,a1 as xe,a7 as W,ae as ye,af as x,a9 as Q,aq as X,as as le,ah as we,ai as De,a5 as N,ao as ke,ac as Me,J as Ue}from"./index-60f805bc.js";import{c as ie,a as M,u as me,d as w,e as Se}from"./index.esm-d48a5f60.js";import{v as te,V as $e,b as Ce,a as Ae,c as Fe}from"./index-775a98c2.js";import{d as Be}from"./index-a9579fe3.js";import{v as Ie}from"./vue-the-mask-c365cabc.js";import{V as ce}from"./VForm-31b90092.js";import{V as T}from"./VRow-9a4de2eb.js";import{V}from"./VCol-52fdbe26.js";import{V as Z,a as qe}from"./VSelect-f819653e.js";import{V as ze}from"./VDatePicker-e1e97b1e.js";import{_ as Ee}from"./AppointTable-304cdc1e.js";import{V as Te}from"./VContainer-07a9620e.js";import{b as oe,V as se,a as Pe,c as L}from"./VList-3697379c.js";import{V as Ne}from"./VSheet-b11acff0.js";import"./VDataTable-d7a6696e.js";const Le=n("div",{class:"text-h6 mx-2 my-3"},"編輯使用者資料",-1),je={class:"text-end mb-3"},Re={__name:"EditUserDialog",setup(I){const d=S(!1),b=ee(),P=re(),{apiAuth:D}=de(),A=()=>{d.value=!0},i=ie({user_name:M().required("必填"),honorific:M().required("必填"),national_id:M().required("必填").test("isNI","身分證格式錯誤",v=>Be.isNationalIdentificationNumberValid(v)),email:M().required("必填").test("isEmail","信箱格式錯誤",v=>te.isEmail(v)),phone:M().required("必填").test("isPhone","手機號碼格式錯誤",v=>(v=v.replace(/-/g,""),te.isMobilePhone(v,"zh-TW"))),address:M()}),{handleSubmit:h,isSubmitting:U}=me({validationSchema:i}),$=w("user_name"),m=w("honorific"),r=w("national_id"),s=w("email"),p=w("phone"),F=w("address");pe(()=>{$.value.value=b.user_name,m.value.value=b.honorific,r.value.value=b.national_id,s.value.value=b.email,p.value.value=b.phone,F.value.value=b.address});const Y=h(async v=>{v.phone=v.phone.replace(/-/g,""),await D.patch(`/users/${b._id}`,v),b.login(v),P({text:"更新成功",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"success",location:"bottom"}})});return(v,u)=>(_(),C(q,null,[e(z,{"append-icon":"mdi-pencil",color:"teal",variant:"tonal",rounded:"",onClick:A},{default:a(()=>[f("編輯 ")]),_:1}),e(ue,{modelValue:d.value,"onUpdate:modelValue":u[7]||(u[7]=c=>d.value=c),width:500,persistent:""},{default:a(()=>[e(B,null,{default:a(()=>[e(ce,{disabled:t(U),onSubmit:ne(t(Y),["prevent"])},{default:a(()=>[e(ae,null,{default:a(()=>[Le,e(T,{class:"py-3"},{default:a(()=>[e(V,{cols:"12",md:"6",class:"py-0"},{default:a(()=>[e(y,{label:"姓名",modelValue:t($).value.value,"onUpdate:modelValue":u[0]||(u[0]=c=>t($).value.value=c),"error-messages":t($).errorMessage.value,color:"teal",variant:"solo-filled",flat:"",rounded:"lg"},null,8,["modelValue","error-messages"])]),_:1}),e(V,{cols:"12",md:"6",class:"py-0"},{default:a(()=>[e(Z,{label:"稱謂",items:["先生","女士"],color:"teal",variant:"solo-filled",flat:"",rounded:"lg",modelValue:t(m).value.value,"onUpdate:modelValue":u[1]||(u[1]=c=>t(m).value.value=c),"error-messages":t(m).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1})]),_:1}),e(y,{label:"身分證字號",color:"teal",variant:"solo-filled",flat:"",rounded:"lg",modelValue:t(r).value.value,"onUpdate:modelValue":u[2]||(u[2]=c=>t(r).value.value=c),"error-messages":t(r).errorMessage.value},null,8,["modelValue","error-messages"]),e(y,{label:"電子信箱",type:"email",color:"teal",variant:"solo-filled",flat:"",rounded:"lg",modelValue:t(s).value.value,"onUpdate:modelValue":u[3]||(u[3]=c=>t(s).value.value=c),"error-messages":t(s).errorMessage.value},null,8,["modelValue","error-messages"]),ge(e(y,{label:"手機號碼",type:"tel",color:"teal",variant:"solo-filled",flat:"",rounded:"lg",modelValue:t(p).value.value,"onUpdate:modelValue":u[4]||(u[4]=c=>t(p).value.value=c),"error-messages":t(p).errorMessage.value},null,8,["modelValue","error-messages"]),[[t(Ie.mask),"####-###-###"]]),e(y,{label:"住址",color:"teal",variant:"solo-filled",flat:"",rounded:"lg",modelValue:t(F).value.value,"onUpdate:modelValue":u[5]||(u[5]=c=>t(F).value.value=c),"error-messages":t(F).errorMessage.value},null,8,["modelValue","error-messages"]),n("div",je,[e(z,{color:"teal",variant:"text",class:"me-3",onClick:u[6]||(u[6]=c=>d.value=!1)},{default:a(()=>[f("取消 ")]),_:1}),e(z,{type:"submit",color:"teal"},{default:a(()=>[f("儲存")]),_:1})])]),_:1})]),_:1},8,["disabled","onSubmit"])]),_:1})]),_:1},8,["modelValue"])],64))}},We=n("div",{class:"text-h6 mx-2 my-3"},"新增寵物",-1),Ye=n("div",{class:"text-subtitle-1 font-weight-medium mt-4 ms-2 mb-2"},"照片",-1),Ge={class:"text-end"},Je={__name:"AddPet",emits:["update"],setup(I,{emit:d}){const b=ee(),{apiAuth:P}=be(),D=re(),A=d,i=S(!1),h=S(null),U=S(!1),$=S(null),m=S([]),r=S([]),s=E(()=>h.value?h.value.toLocaleDateString():null),p=E(()=>{if(h.value){const k=new Date,o=new Date(h.value);let g=k.getFullYear()-o.getFullYear();const l=k.getMonth()-o.getMonth();return(l<0||l===0&&k.getDate()<o.getDate())&&g--,g}return null}),F=E(()=>{if(h.value){const k=new Date,o=new Date(h.value);let g=k.getMonth()-o.getMonth();return(g<0||g===0&&k.getDate()<o.getDate())&&(g=g+12),g}return null}),Y=ie({name:M().required("姓名為必填欄位"),species:M().required("種族為必填欄位"),breed:M().required("品種為必填欄位"),gender:M().required("性別為必填欄位"),weight:Se().typeError("商品價格格式錯誤").required("體重為必填欄位")}),{handleSubmit:v,isSubmitting:u,resetForm:c}=me({validationSchema:Y}),G=w("name"),J=w("species"),O=w("breed"),H=w("gender"),K=w("weight"),fe=()=>{c(),i.value=!0},ve=v(async k=>{var o,g;try{const l=new FormData;for(const R in k)l.append(R,k[R]);m.value.length>0?l.append("image",m.value[0].file):l.append("image",null),l.append("birth",s.value),l.append("owner",b._id),l.append("chip_id",""),l.append("personality",""),await P.post("/pets",l),A("update"),D({text:"新增成功",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"success",location:"bottom"}}),i.value=!1}catch(l){const R=((g=(o=l==null?void 0:l.response)==null?void 0:o.data)==null?void 0:g.message)||"發生錯誤，請稍後再試";D({text:R,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"error",location:"bottom"}})}});return(k,o)=>{const g=_e("VueFileAgent");return _(),C(q,null,[e(z,{color:"teal",variant:"tonal",class:"mt-1",rounded:"","append-icon":"mdi-plus-circle-outline",onClick:fe},{default:a(()=>[f("新增寵物 ")]),_:1}),e(ue,{modelValue:i.value,"onUpdate:modelValue":o[14]||(o[14]=l=>i.value=l),width:"800",persistent:""},{default:a(()=>[e(B,null,{default:a(()=>[e(ce,{disabled:t(u),onSubmit:ne(t(ve),["prevent"])},{default:a(()=>[e(ae,null,{default:a(()=>[We,e(T,null,{default:a(()=>[e(V,{cols:"12",md:"6"},{default:a(()=>[e(y,{label:"姓名",color:"teal",modelValue:t(G).value.value,"onUpdate:modelValue":o[0]||(o[0]=l=>t(G).value.value=l),"error-messages":t(G).errorMessage.value},null,8,["modelValue","error-messages"]),e(y,{label:"體重",type:"string","model-value":"0",suffix:"(g)",color:"teal",modelValue:t(K).value.value,"onUpdate:modelValue":o[1]||(o[1]=l=>t(K).value.value=l),"error-messages":t(K).errorMessage.value},null,8,["modelValue","error-messages"]),Ye,e(g,{modelValue:m.value,"onUpdate:modelValue":o[2]||(o[2]=l=>m.value=l),"raw-model-value":r.value,"onUpdate:rawModelValue":o[3]||(o[3]=l=>r.value=l),"error-text":{type:"檔案格式不支援",size:"檔案超過 1MB 大小限制"},accept:"image/jpeg,image/png",ref_key:"fileAgent",ref:$,"max-size":"1MB","max-files":1,deletable:""},null,8,["modelValue","raw-model-value"])]),_:1}),e(V,{cols:"12",md:"6"},{default:a(()=>[e(Z,{label:"性別",items:["公","母"],color:"teal",modelValue:t(H).value.value,"onUpdate:modelValue":o[4]||(o[4]=l=>t(H).value.value=l),"error-messages":t(H).errorMessage.value},null,8,["modelValue","error-messages"]),e(Z,{label:"種族",items:["犬","貓","兔","鼠","鳥","兩棲","其他"],color:"teal",modelValue:t(J).value.value,"onUpdate:modelValue":o[5]||(o[5]=l=>t(J).value.value=l),"error-messages":t(J).errorMessage.value},null,8,["modelValue","error-messages"]),e(y,{label:"品種",color:"teal",modelValue:t(O).value.value,"onUpdate:modelValue":o[6]||(o[6]=l=>t(O).value.value=l),"error-messages":t(O).errorMessage.value},null,8,["modelValue","error-messages"]),e(qe,{modelValue:U.value,"onUpdate:modelValue":o[10]||(o[10]=l=>U.value=l),"close-on-content-click":!1},{activator:a(({props:l})=>[e(y,Ve({label:"出生日期","model-value":s.value,color:"teal",readonly:""},l),null,16,["model-value"])]),default:a(()=>[e(ze,{onInput:o[7]||(o[7]=l=>U.value=!1),modelValue:h.value,"onUpdate:modelValue":[o[8]||(o[8]=l=>h.value=l),o[9]||(o[9]=l=>U.value=!1)],color:"teal"},null,8,["modelValue"])]),_:1},8,["modelValue"]),e(T,null,{default:a(()=>[e(V,{cols:"6"},{default:a(()=>[e(y,{label:"年齡",modelValue:p.value,"onUpdate:modelValue":o[11]||(o[11]=l=>p.value=l),suffix:"(歲)",color:"teal",readonly:""},null,8,["modelValue"])]),_:1}),e(V,{cols:"6"},{default:a(()=>[e(y,{label:"月份",modelValue:F.value,"onUpdate:modelValue":o[12]||(o[12]=l=>F.value=l),suffix:"(月)",color:"teal",readonly:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),n("div",Ge,[e(z,{color:"teal",variant:"text",class:"me-3",onClick:o[13]||(o[13]=l=>i.value=!1)},{default:a(()=>[f("取消 ")]),_:1}),e(z,{color:"teal",loading:t(u),type:"submit"},{default:a(()=>[f("新增 ")]),_:1},8,["loading"])])]),_:1})]),_:1},8,["disabled","onSubmit"])]),_:1})]),_:1},8,["modelValue"])],64)}}};const j=I=>(we("data-v-428b3ff2"),I=I(),De(),I),Oe={class:"overflow"},He={key:0,class:"image-paw"},Ke=j(()=>n("div",{class:"circle-top"},null,-1)),Qe=j(()=>n("div",{class:"circle-bottom"},null,-1)),Xe={key:0,class:"ma-3 title"},Ze={class:"small-title"},ea={class:"d-flex justify-space-between"},aa={class:"d-flex flex-column flex-sm-row"},la={class:"small-title"},ta={class:"text-caption"},oa=j(()=>n("p",null,"體重",-1)),sa={class:"text-h6"},ra=j(()=>n("p",null,"年齡",-1)),na={class:"text-h6"},ua={class:"text-h6"},da=j(()=>n("p",null,"出生日期",-1)),ia={class:"text-h6"},ma={__name:"AccountView",setup(I){const d=ee(),{api:b}=de(),{smAndUp:P}=xe(),D=S(0),A=S([]),i=E(()=>P.value),h=E(()=>`https://source.boringavatars.com/beam/120/${encodeURIComponent(d.user_name)}?colors=545454,7B8A84,B2DFDB,EDE7D5,B7CC18`),U=async()=>{d.address||(d.address="尚未填寫");try{const{data:m}=await b.get(`/pets/owner/${d._id}`);if(!m.result)return;m.result.forEach(r=>{r.birth=new Date(r.birth).toLocaleDateString("zh-TW"),r.age=new Date().getFullYear()-new Date(r.birth).getFullYear(),r.month=new Date().getMonth()-new Date(r.birth).getMonth(),(r.month<0||r.month===0&&new Date().getDate()<new Date(r.birth).getDate())&&(r.age-=1,r.month+=12)}),A.value=m.result}catch(m){console.log(m)}};U();const $=E(()=>[{icon:"mdi-phone",text:d.phone},{icon:"mdi-card-account-details",text:d.national_id},{icon:"mdi-map-marker",text:d.address},{icon:"mdi-email",text:d.email}]);return(m,r)=>(_(),C(q,null,[n("div",Oe,[i.value?(_(),C("div",He)):W("",!0),Ke,Qe]),e(Te,{style:ye(i.value?"margin-top: 20vh;":"margin-top: 10vh;")},{default:a(()=>[e(T,null,{default:a(()=>[e(V,{cols:"12",md:"10","offset-md":"1",class:"pt-0"},{default:a(()=>[i.value?W("",!0):(_(),C("div",Xe,"個人帳號")),e(B,{class:"px-4 py-2",rounded:"lg",style:{background:"rgba(255, 255, 255, 0.8)"},flat:""},{default:a(()=>[e(oe,{class:"pb-0","bg-color":"transparent"},{default:a(()=>[e(se,{"prepend-avatar":h.value,class:"pe-0"},{append:a(()=>[e(Re)]),default:a(()=>[e(Pe,null,{default:a(()=>[f(x(t(d).user_name)+" ",1),n("span",Ze," ("+x(t(d).honorific)+")",1)]),_:1})]),_:1},8,["prepend-avatar"])]),_:1}),e(L,{class:"my-1"}),n("div",null,[e(oe,{class:"pa-0 d-flex flex-column flex-md-row justify-md-space-between overflow-hidden",disabled:"","bg-color":"transparent"},{default:a(()=>[(_(!0),C(q,null,Q($.value,s=>(_(),N(se,{key:s,"prepend-icon":s.icon},{default:a(()=>[f(x(s.text),1)]),_:2},1032,["prepend-icon"]))),128))]),_:1})])]),_:1})]),_:1}),e(V,{cols:"12",md:"10","offset-md":"1"},{default:a(()=>[e(B,{class:"pa-3",rounded:"lg",style:{background:"rgba(255, 255, 255, 0.7)"},flat:""},{default:a(()=>[n("div",ea,[e(X,{class:"card-title"},{default:a(()=>[f("寵物資料")]),_:1}),e(Je,{onUpdate:U})]),e(L,{class:"mt-1 mb-sm-3"}),n("div",aa,[e(T,null,{default:a(()=>[e(V,{cols:"12",sm:"2",class:le(i.value?"":"mt-3 pb-0")},{default:a(()=>[e($e,{modelValue:D.value,"onUpdate:modelValue":r[0]||(r[0]=s=>D.value=s),direction:i.value?"vertical":"horizontal",color:"teal"},{default:a(()=>[(_(!0),C(q,null,Q(A.value,(s,p)=>(_(),N(Ae,{key:p,value:p,class:le(D.value===p?"tab-focus":""),rounded:i.value?"e-lg":"t-lg"},{default:a(()=>[f(x(s.name),1)]),_:2},1032,["value","class","rounded"]))),128))]),_:1},8,["modelValue","direction"])]),_:1},8,["class"]),e(V,{cols:"12",sm:"10",class:"pb-2"},{default:a(()=>[e(Ce,{modelValue:D.value,"onUpdate:modelValue":r[1]||(r[1]=s=>D.value=s),touch:""},{default:a(()=>[(_(!0),C(q,null,Q(A.value,(s,p)=>(_(),N(Fe,{key:p,value:p},{default:a(()=>[e(B,{class:"pa-0 mb-3",flat:"",style:{"background-color":"#ffffff00"}},{default:a(()=>[e(X,{class:"ma-3 card-title"},{default:a(()=>[f("基本資料")]),_:1}),e(B,{class:"mx-2 mb-2",flat:"",style:{"background-color":"#ffffff00"}},{prepend:a(()=>[e(ke,{size:i.value?"60":"40",class:"me-2"},{default:a(()=>[e(Me,{src:s.image,cover:""},null,8,["src"])]),_:2},1032,["size"])]),title:a(()=>[f(x(s.name),1),n("span",la," ("+x(s.species)+")",1)]),subtitle:a(()=>[n("p",ta,"晶片號碼："+x(s.chip_id),1)]),append:a(()=>[e(Ue,{icon:s.gender==="公"?"mdi-gender-male":"mdi-gender-female",color:"teal",size:"40"},null,8,["icon"])]),_:2},1024),e(Ne,{class:"mx-2 mb-2 px-3 sheet",rounded:""},{default:a(()=>[e(ae,null,{default:a(()=>[e(T,null,{default:a(()=>[e(V,{cols:"12",sm:"4"},{default:a(()=>[oa,n("span",sa,x(s.weight),1),f("(g) ")]),_:2},1024),i.value?(_(),N(L,{key:0,color:"teal",class:"my-2",vertical:""})):W("",!0),e(V,{cols:"12",sm:"4"},{default:a(()=>[ra,n("span",na,x(s.age),1),f(" 歲 "),n("span",ua,x(s.month),1),f(" 月 ")]),_:2},1024),i.value?(_(),N(L,{key:1,color:"teal",class:"my-2",vertical:""})):W("",!0),e(V,{cols:"12",sm:"4"},{default:a(()=>[da,n("span",ia,x(s.birth),1)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024),e(L),e(B,{class:"pa-0 mb-1",flat:"",style:{"background-color":"#ffffff00"}},{default:a(()=>[e(X,{class:"ma-3 card-title"},{default:a(()=>[f("掛號紀錄")]),_:1}),e(Ee,{id:s._id},null,8,["id"])]),_:2},1024)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})])]),_:1})]),_:1})]),_:1})]),_:1},8,["style"])],64))}},Ua=he(ma,[["__scopeId","data-v-428b3ff2"]]);export{Ua as default};
