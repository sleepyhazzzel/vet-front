import{p as Fe,aV as Ie,aW as Pe,g as Ue,aX as $e,u as Be,aY as Re,c as B,r as f,s as Te,j as Ee,o as fe,w as K,b as Ne,f as qe,aZ as Ae,a_ as ce,a$ as He,h as e,b0 as ze,i as Q,ab as ee,G as ne,ax as Ge,b1 as Oe,b2 as je,aF as Le,aD as oe,b3 as Ye,U as Ze,a as Je,_ as pe,a1 as ge,Z as Ve,aM as We,a4 as J,a6 as ae,a7 as o,aa as s,ak as be,ap as ue,al as D,ai as R,V as A,ad as H,ah as Xe,am as re,aq as Ke,ar as xe,an as _e,ao as ye,$ as Qe,a0 as ea,a2 as aa,a5 as me,J as ta,ae as la}from"./index-d4ec24c3.js";import{v as oa}from"./vue-the-mask-579fda6b.js";import{u as we,a as G,d as q,c as sa,e as na}from"./index.esm-c705680a.js";import{_ as ua}from"./SearchDialog-6da882a2.js";import{V as he}from"./VForm-8662b32e.js";import{a as De,V as se}from"./VSelect-575b63ba.js";import{V as ke}from"./VDatePicker-3378d49f.js";import{V as ra}from"./VContainer-9cbfca84.js";import{V as ia,b as da}from"./VToolbar-e2a2a77f.js";import{V as Z}from"./VRow-41a4f9a4.js";import{V as $}from"./VCol-8d4a0ece.js";import{V as ca}from"./VDataTable-f5d357cf.js";import{c as ve}from"./VList-f69f5da4.js";import"./index-465bd8ec.js";import"./VSheet-e14ce167.js";const ma=Fe({autoGrow:Boolean,autofocus:Boolean,counter:[Boolean,Number,String],counterValue:Function,prefix:String,placeholder:String,persistentPlaceholder:Boolean,persistentCounter:Boolean,noResize:Boolean,rows:{type:[Number,String],default:5,validator:a=>!isNaN(parseFloat(a))},maxRows:{type:[Number,String],validator:a=>!isNaN(parseFloat(a))},suffix:String,modelModifiers:Object,...Ie(),...Pe()},"VTextarea"),va=Ue()({name:"VTextarea",directives:{Intersect:$e},inheritAttrs:!1,props:ma(),emits:{"click:control":a=>!0,"mousedown:control":a=>!0,"update:focused":a=>!0,"update:modelValue":a=>!0},setup(a,z){let{attrs:k,emit:C,slots:c}=z;const d=Be(a,"modelValue"),{isFocused:p,focus:S,blur:F}=Re(a),g=B(()=>typeof a.counterValue=="function"?a.counterValue(d.value):(d.value||"").toString().length),O=B(()=>{if(k.maxlength)return k.maxlength;if(!(!a.counter||typeof a.counter!="number"&&typeof a.counter!="string"))return a.counter});function j(u,_){var v,h;!a.autofocus||!u||(h=(v=_[0].target)==null?void 0:v.focus)==null||h.call(v)}const L=f(),I=f(),Y=Te(""),y=f(),T=B(()=>a.persistentPlaceholder||p.value||a.active);function M(){var u;y.value!==document.activeElement&&((u=y.value)==null||u.focus()),p.value||S()}function P(u){M(),C("click:control",u)}function E(u){C("mousedown:control",u)}function b(u){u.stopPropagation(),M(),oe(()=>{d.value="",Ye(a["onClick:clear"],u)})}function i(u){var v;const _=u.target;if(d.value=_.value,(v=a.modelModifiers)!=null&&v.trim){const h=[_.selectionStart,_.selectionEnd];oe(()=>{_.selectionStart=h[0],_.selectionEnd=h[1]})}}const r=f(),x=f(+a.rows),m=B(()=>["plain","underlined"].includes(a.variant));Ee(()=>{a.autoGrow||(x.value=+a.rows)});function U(){a.autoGrow&&oe(()=>{if(!r.value||!I.value)return;const u=getComputedStyle(r.value),_=getComputedStyle(I.value.$el),v=parseFloat(u.getPropertyValue("--v-field-padding-top"))+parseFloat(u.getPropertyValue("--v-input-padding-top"))+parseFloat(u.getPropertyValue("--v-field-padding-bottom")),h=r.value.scrollHeight,N=parseFloat(u.lineHeight),W=Math.max(parseFloat(a.rows)*N+v,parseFloat(_.getPropertyValue("--v-input-control-height"))),X=parseFloat(a.maxRows)*N+v||1/0,n=Je(h??0,W,X);x.value=Math.floor((n-v)/N),Y.value=Ze(n)})}fe(U),K(d,U),K(()=>a.rows,U),K(()=>a.maxRows,U),K(()=>a.density,U);let w;return K(r,u=>{u?(w=new ResizeObserver(U),w.observe(r.value)):w==null||w.disconnect()}),Ne(()=>{w==null||w.disconnect()}),qe(()=>{const u=!!(c.counter||a.counter||a.counterValue),_=!!(u||c.details),[v,h]=Ae(k),{modelValue:N,...W}=ce.filterProps(a),X=He(a);return e(ce,Q({ref:L,modelValue:d.value,"onUpdate:modelValue":n=>d.value=n,class:["v-textarea v-text-field",{"v-textarea--prefixed":a.prefix,"v-textarea--suffixed":a.suffix,"v-text-field--prefixed":a.prefix,"v-text-field--suffixed":a.suffix,"v-textarea--auto-grow":a.autoGrow,"v-textarea--no-resize":a.noResize||a.autoGrow,"v-input--plain-underlined":m.value},a.class],style:a.style},v,W,{centerAffix:x.value===1&&!m.value,focused:p.value}),{...c,default:n=>{let{id:l,isDisabled:t,isDirty:V,isReadonly:le,isValid:Ce}=n;return e(ze,Q({ref:I,style:{"--v-textarea-control-height":Y.value},onClick:P,onMousedown:E,"onClick:clear":b,"onClick:prependInner":a["onClick:prependInner"],"onClick:appendInner":a["onClick:appendInner"]},X,{id:l.value,active:T.value||V.value,centerAffix:x.value===1&&!m.value,dirty:V.value||a.dirty,disabled:t.value,focused:p.value,error:Ce.value===!1}),{...c,default:Se=>{let{props:{class:ie,...de}}=Se;return e(ee,null,[a.prefix&&e("span",{class:"v-text-field__prefix"},[a.prefix]),ne(e("textarea",Q({ref:y,class:ie,value:d.value,onInput:i,autofocus:a.autofocus,readonly:le.value,disabled:t.value,placeholder:a.placeholder,rows:a.rows,name:a.name,onFocus:M,onBlur:F},de,h),null),[[Ge("intersect"),{handler:j},null,{once:!0}]]),a.autoGrow&&ne(e("textarea",{class:[ie,"v-textarea__sizer"],id:`${de.id}-sizer`,"onUpdate:modelValue":Me=>d.value=Me,ref:r,readonly:!0,"aria-hidden":"true"},null),[[Oe,d.value]]),a.suffix&&e("span",{class:"v-text-field__suffix"},[a.suffix])])}})},details:_?n=>{var l;return e(ee,null,[(l=c.details)==null?void 0:l.call(c,n),u&&e(ee,null,[e("span",null,null),e(je,{active:a.persistentCounter||p.value,value:g.value,max:O.value},c.counter)])])}:void 0})}),Le({},L,I,y)}});const fa=a=>(_e("data-v-aecc3f18"),a=a(),ye(),a),pa=fa(()=>R("div",{class:"text-h6 mx-2 my-3"},"診療紀錄",-1)),ga={class:"text-end mb-2"},Va={__name:"DescriptionDialog",emits:["update"],setup(a,{expose:z,emit:k}){const C=f(!1),c=f(""),d=f(!1),p=f(null),S=ge(),{api:F}=xe(),g=Ve(),O=We(),j=k,{handleSubmit:L,isSubmitting:I,resetForm:Y}=we({validationSchema:{description:G().required("描述為必填欄位")}}),y=q("description"),T=b=>{b?(c.value=b._id,p.value=new Date(b.date),y.value.value=b.description):(c.value="",p.value=new Date),C.value=!0},M=()=>{C.value=!1,p.value=new Date,Y({description:""})},P=B(()=>p.value?p.value.toLocaleDateString():null),E=L(async b=>{var i,r;try{const x={date:P.value,description:b.description,edit_by:O.account+" "+O.position};c.value===""?await F.post("/pets/medical/"+g.params.id,x):await F.patch(`/pets/medical/${g.params.id}/${c.value}`,x),j("update"),C.value=!1;const m=c.value===""?"新增成功":"修改成功";S({text:m,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"success",location:"bottom"}})}catch(x){const m=((r=(i=x==null?void 0:x.response)==null?void 0:i.data)==null?void 0:r.message)||"發生錯誤，請稍後再試";S({text:m,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"error",location:"bottom"}})}});return z({openDialog:T}),(b,i)=>(J(),ae(Ke,{width:800,modelValue:C.value,"onUpdate:modelValue":i[4]||(i[4]=r=>C.value=r),persistent:""},{default:o(()=>[e(re,null,{default:o(()=>[e(he,{disabled:s(I),onSubmit:be(s(E),["prevent"])},{default:o(()=>[e(ue,null,{default:o(()=>[pa,e(De,{modelValue:d.value,"onUpdate:modelValue":i[2]||(i[2]=r=>d.value=r),"close-on-content-click":!1},{activator:o(({props:r})=>[e(D,Q({label:"診療日期","model-value":P.value,color:"teal",readonly:""},r),null,16,["model-value"])]),default:o(()=>[e(ke,{onInput:i[0]||(i[0]=r=>d.value=!1),modelValue:p.value,"onUpdate:modelValue":i[1]||(i[1]=r=>p.value=r),height:"430px",color:"teal"},null,8,["modelValue"])]),_:1},8,["modelValue"]),e(va,{label:"描述",color:"teal",modelValue:s(y).value.value,"onUpdate:modelValue":i[3]||(i[3]=r=>s(y).value.value=r),"error-messages":s(y).errorMessage.value},null,8,["modelValue","error-messages"]),R("div",ga,[e(A,{disabled:s(I),variant:"text",onClick:M},{default:o(()=>[H("取消")]),_:1},8,["disabled"]),e(A,{type:"submit",color:"teal"},{default:o(()=>[H(Xe(c.value===""?"新增":"送出"),1)]),_:1})])]),_:1})]),_:1},8,["disabled","onSubmit"])]),_:1})]),_:1},8,["modelValue"]))}},ba=pe(Va,[["__scopeId","data-v-aecc3f18"]]);const te=a=>(_e("data-v-785dda2c"),a=a(),ye(),a),xa=te(()=>R("div",{class:"text-subtitle-1 font-weight-medium ms-2 mb-2"},"基本資訊",-1)),_a=te(()=>R("div",{class:"text-subtitle-1 font-weight-medium mb-2 ms-2"},"照片",-1)),ya={class:"d-flex justify-space-between align-center"},wa=te(()=>R("div",{class:"text-subtitle-1 font-weight-medium ms-2 mb-2"},"飼主資訊",-1)),ha={key:0,class:"text-end"},Da={class:"text-end"},ka={class:"d-flex justify-space-between align-center"},Ca=te(()=>R("div",{class:"text-subtitle-1 font-weight-medium ms-2 mb-2"},"診療紀錄",-1)),Sa={__name:"MedicalDetail",setup(a){const z=f(!1),k=f(!0),C=f(null),c=f(null),d=Ve(),p=Qe(),{api:S}=xe(),F=ge(),g=ea(),{sm:O}=aa(),j=B(()=>O.value),L=()=>{p.go(-1)},I=sa({name:G().required("姓名為必填欄位"),species:G().required("種族為必填欄位"),breed:G().required("品種為必填欄位"),gender:G().required("性別為必填欄位"),weight:na().required("體重為必填欄位"),personality:G().required("性格為必填欄位"),chip_id:G().required("晶片號碼為必填欄位").matches(/^.{4}-.{4}-.{4}-.{4}$/,"晶片號碼格式錯誤")}),{handleSubmit:Y,isSubmitting:y}=we({validationSchema:I}),T=q("name"),M=q("species"),P=q("breed"),E=q("gender"),b=q("weight"),i=q("personality"),r=q("chip_id"),x=f(null),m=f(null),U=f([]);fe(async()=>{var n,l;try{const{data:t}=await S.get(`/pets/${d.params.id}`);console.log(t.result),T.value.value=t.result.name,M.value.value=t.result.species,P.value.value=t.result.breed,E.value.value=t.result.gender,b.value.value=t.result.weight,m.value=new Date(t.result.birth),t.result.personality?i.value.value=t.result.personality:i.value.value="",r.value.value=t.result.chip_id.replace(/-/g,""),x.value=t.result.image;const{data:V}=await S.get(`/users/${t.result.owner}`);g.login(V.result)}catch(t){console.log(t);const V=((l=(n=t==null?void 0:t.response)==null?void 0:n.data)==null?void 0:l.message)||"發生錯誤，請稍後再試";F({text:V,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}});const w=B(()=>{if(m.value){const n=new Date,l=new Date(m.value);let t=n.getFullYear()-l.getFullYear();const V=n.getMonth()-l.getMonth();return(V<0||V===0&&n.getDate()<l.getDate())&&t--,t}return null}),u=B(()=>{if(m.value){const n=new Date,l=new Date(m.value);let t=n.getMonth()-l.getMonth();return(t<0||t===0&&n.getDate()<l.getDate())&&(t=t+12),t}return null}),_=B(()=>m.value?m.value.toLocaleDateString():null),v=n=>{c.value.openDialog(n)},h=[{title:"日期",key:"date"},{title:"描述",key:"description",sortable:!1},{title:"主治醫生",key:"edit_by"},{title:"編輯 / 刪除",key:"actions",align:"center",sortable:!1}],N=async()=>{try{k.value=!0;const{data:n}=await S.get("/pets/medical/"+d.params.id);U.value=n.result.descriptions}catch(n){console.log(n)}k.value=!1};N();const W=Y(async n=>{var l,t;try{g._id!==null&&(n.owner=g._id),n.birth=_.value,await S.patch("/pets/"+d.params.id,n),F({text:"更新成功",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"success",location:"bottom"}})}catch(V){const le=((t=(l=V==null?void 0:V.response)==null?void 0:l.data)==null?void 0:t.message)||"發生錯誤，請稍後再試";F({text:le,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}}),X=async n=>{try{await S.delete("/pets/medical/"+d.params.id+"/"+n._id),F({text:"刪除成功",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"success",location:"bottom"}}),N()}catch(l){console.log(l)}};return(n,l)=>(J(),me(ee,null,[e(A,{variant:"text",class:"ms-4","prepend-icon":"mdi-arrow-left",onClick:L},{default:o(()=>[H("返回")]),_:1}),e(ra,null,{default:o(()=>[e(he,{disabled:s(y),onSubmit:be(s(W),["prevent"])},{default:o(()=>[e(re,{class:"mb-3"},{default:o(()=>[e(ia,null,{default:o(()=>[e(ta,{class:"ms-4"},{default:o(()=>[H("mdi-paw")]),_:1}),e(da,{class:"ms-2"},{default:o(()=>[H("編輯寵物病歷")]),_:1})]),_:1}),e(ue,null,{default:o(()=>[e(Z,null,{default:o(()=>[e($,{cols:"12",md:"8",class:"pb-0"},{default:o(()=>[xa,e(Z,null,{default:o(()=>[e($,{cols:"12",md:"6"},{default:o(()=>[e(D,{label:"姓名",color:"teal",modelValue:s(T).value.value,"onUpdate:modelValue":l[0]||(l[0]=t=>s(T).value.value=t),"error-messages":s(T).errorMessage.value},null,8,["modelValue","error-messages"]),e(se,{label:"種族",items:["犬","貓","兔","鼠","鳥","兩棲","其他"],color:"teal",modelValue:s(M).value.value,"onUpdate:modelValue":l[1]||(l[1]=t=>s(M).value.value=t),"error-messages":s(M).errorMessage.value},null,8,["modelValue","error-messages"]),e(D,{label:"品種",color:"teal",modelValue:s(P).value.value,"onUpdate:modelValue":l[2]||(l[2]=t=>s(P).value.value=t),"error-messages":s(P).errorMessage.value},null,8,["modelValue","error-messages"]),_a,e(la,{"max-height":"176",src:x.value,"aspect-ratio":"4/3",class:"bg-grey-lighten-3"},null,8,["src"])]),_:1}),e($,{cols:"12",md:"6"},{default:o(()=>[e(se,{label:"性別",items:["公","母"],color:"teal",modelValue:s(E).value.value,"onUpdate:modelValue":l[3]||(l[3]=t=>s(E).value.value=t),"error-messages":s(E).errorMessage.value},null,8,["modelValue","error-messages"]),e(D,{label:"體重",type:"string","model-value":"0",suffix:"(g)",color:"teal",modelValue:s(b).value.value,"onUpdate:modelValue":l[4]||(l[4]=t=>s(b).value.value=t),"error-messages":s(b).errorMessage.value},null,8,["modelValue","error-messages"]),e(se,{label:"性格",items:["溫和","緊張","危險"],color:"teal",modelValue:s(i).value.value,"onUpdate:modelValue":l[5]||(l[5]=t=>s(i).value.value=t),"error-messages":s(i).errorMessage.value},null,8,["modelValue","error-messages"]),e(De,{modelValue:z.value,"onUpdate:modelValue":l[8]||(l[8]=t=>z.value=t),"close-on-content-click":!1},{activator:o(({props:t})=>[e(D,Q({label:"出生日期","model-value":_.value,color:"teal",readonly:""},t),null,16,["model-value"])]),default:o(()=>[e(ke,{onInput:l[6]||(l[6]=t=>z.value=!1),modelValue:m.value,"onUpdate:modelValue":l[7]||(l[7]=t=>m.value=t),color:"teal"},null,8,["modelValue"])]),_:1},8,["modelValue"]),e(Z,null,{default:o(()=>[e($,{cols:"6"},{default:o(()=>[e(D,{label:"年齡",modelValue:w.value,"onUpdate:modelValue":l[9]||(l[9]=t=>w.value=t),suffix:"(歲)",color:"teal",readonly:""},null,8,["modelValue"])]),_:1}),e($,{cols:"6"},{default:o(()=>[e(D,{label:"月份",modelValue:u.value,"onUpdate:modelValue":l[10]||(l[10]=t=>u.value=t),suffix:"(月)",color:"teal",readonly:""},null,8,["modelValue"])]),_:1})]),_:1}),ne(e(D,{label:"晶片號碼",color:"teal",modelValue:s(r).value.value,"onUpdate:modelValue":l[11]||(l[11]=t=>s(r).value.value=t),"error-messages":s(r).errorMessage.value},null,8,["modelValue","error-messages"]),[[s(oa.mask),"####-####-####-####"]])]),_:1})]),_:1})]),_:1}),j.value?(J(),ae(ve,{key:0,class:"mx-3"})):(J(),ae(ve,{key:1,vertical:"",class:"my-3"})),e($,{cols:"12",md:"4",class:"pb-0"},{default:o(()=>[e(Z,null,{default:o(()=>[e($,{cols:"12"},{default:o(()=>[R("div",ya,[wa,e(ua)]),e(D,{label:"姓名",color:"teal",modelValue:s(g).user_name,"onUpdate:modelValue":l[12]||(l[12]=t=>s(g).user_name=t),suffix:s(g).honorific,readonly:""},null,8,["modelValue","suffix"]),e(D,{label:"身分證字號",color:"teal",modelValue:s(g).national_id,"onUpdate:modelValue":l[13]||(l[13]=t=>s(g).national_id=t),readonly:""},null,8,["modelValue"]),e(D,{label:"電話",color:"teal",modelValue:s(g).phone,"onUpdate:modelValue":l[14]||(l[14]=t=>s(g).phone=t),readonly:""},null,8,["modelValue"])]),_:1})]),_:1}),j.value?(J(),me("div",ha,[e(A,{color:"teal",type:"submit",class:"mb-4"},{default:o(()=>[H("更新寵物病歷")]),_:1})])):(J(),ae(Z,{key:1,style:{height:"220px"}},{default:o(()=>[e($,{cols:"12","align-self":"end"},{default:o(()=>[R("div",Da,[e(A,{color:"teal",type:"submit",flat:""},{default:o(()=>[H("更新寵物病歷")]),_:1})])]),_:1})]),_:1}))]),_:1})]),_:1})]),_:1})]),_:1}),e(re,null,{default:o(()=>[e(ue,{class:"pb-0"},{default:o(()=>[e(Z,null,{default:o(()=>[e($,{cols:"12"},{default:o(()=>[R("div",ka,[Ca,e(A,{color:"teal",density:"compact",variant:"text",class:"align-self-start",onClick:l[15]||(l[15]=t=>v(n.item))},{default:o(()=>[H("新增診療紀錄 ")]),_:1})]),e(ca,{headers:h,"sort-by":[{key:"date",order:"desc"}],items:U.value,loading:k.value,"items-per-page":10,"no-data-text":k.value?"載入中...":"無資料",color:"teal",class:"mb-4 elevation-1"},{"item.actions":o(({item:t})=>[e(A,{color:"teal",icon:"mdi-pencil",variant:"text",onClick:V=>v(t)},null,8,["onClick"]),e(A,{icon:"mdi-delete",variant:"text",color:"grey",onClick:V=>X(t)},null,8,["onClick"])]),_:2},1032,["items","loading","no-data-text"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["disabled","onSubmit"])]),_:1}),e(ba,{item:C.value,ref_key:"elDESCDialog",ref:c,onUpdate:N},null,8,["item"])],64))}},Ga=pe(Sa,[["__scopeId","data-v-785dda2c"]]);export{Ga as default};
