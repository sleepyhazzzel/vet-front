import{p as Fe,aW as Ie,aX as Pe,g as Ue,aY as $e,u as Be,aZ as Re,c as R,r as f,s as Te,j as Ee,o as fe,w as K,b as Ne,f as qe,a_ as Ae,a$ as ce,b0 as Ge,h as e,b1 as He,i as Q,ab as ae,G as re,ay as ze,b2 as Oe,b3 as je,aG as Le,aE as ne,b4 as Ye,U as Ze,a as Je,_ as pe,a1 as ge,Z as Ve,aN as We,a4 as J,a6 as te,a7 as o,aa as s,aq as be,ar as le,al as k,ai as I,V as A,ad as G,ah as Xe,ao as oe,as as Ke,at as xe,am as _e,an as ye,$ as Qe,a0 as ea,a2 as aa,a5 as me,J as ta,ae as la}from"./index-fa1a0a70.js";import{v as oa}from"./vue-the-mask-0ebda96b.js";import{u as we,a as O,d as q,c as sa,e as na}from"./index.esm-b4ba26f8.js";import{_ as ua}from"./SearchDialog-a9743003.js";import{V as he}from"./VForm-a77da8c3.js";import{a as De,V as ue}from"./VSelect-a23f0010.js";import{V as ke}from"./VDatePicker-4f4daa7a.js";import{_ as ra}from"./AppointTable-fbec97bf.js";import{V as ia}from"./VContainer-17c4b5bd.js";import{V as da,b as ca}from"./VToolbar-d5aa9724.js";import{V as z}from"./VRow-a4ddde0f.js";import{V as D}from"./VCol-1420d651.js";import{V as ma}from"./VDataTable-1e3b7ff8.js";import{c as ve}from"./VList-24642885.js";import"./index-48e13c99.js";import"./VSheet-0025b386.js";const va=Fe({autoGrow:Boolean,autofocus:Boolean,counter:[Boolean,Number,String],counterValue:Function,prefix:String,placeholder:String,persistentPlaceholder:Boolean,persistentCounter:Boolean,noResize:Boolean,rows:{type:[Number,String],default:5,validator:a=>!isNaN(parseFloat(a))},maxRows:{type:[Number,String],validator:a=>!isNaN(parseFloat(a))},suffix:String,modelModifiers:Object,...Ie(),...Pe()},"VTextarea"),fa=Ue()({name:"VTextarea",directives:{Intersect:$e},inheritAttrs:!1,props:va(),emits:{"click:control":a=>!0,"mousedown:control":a=>!0,"update:focused":a=>!0,"update:modelValue":a=>!0},setup(a,H){let{attrs:C,emit:S,slots:c}=H;const d=Be(a,"modelValue"),{isFocused:p,focus:M,blur:P}=Re(a),g=R(()=>typeof a.counterValue=="function"?a.counterValue(d.value):(d.value||"").toString().length),j=R(()=>{if(C.maxlength)return C.maxlength;if(!(!a.counter||typeof a.counter!="number"&&typeof a.counter!="string"))return a.counter});function L(u,_){var v,h;!a.autofocus||!u||(h=(v=_[0].target)==null?void 0:v.focus)==null||h.call(v)}const Y=f(),U=f(),Z=Te(""),y=f(),T=R(()=>a.persistentPlaceholder||p.value||a.active);function F(){var u;y.value!==document.activeElement&&((u=y.value)==null||u.focus()),p.value||M()}function $(u){F(),S("click:control",u)}function E(u){S("mousedown:control",u)}function b(u){u.stopPropagation(),F(),ne(()=>{d.value="",Ye(a["onClick:clear"],u)})}function i(u){var v;const _=u.target;if(d.value=_.value,(v=a.modelModifiers)!=null&&v.trim){const h=[_.selectionStart,_.selectionEnd];ne(()=>{_.selectionStart=h[0],_.selectionEnd=h[1]})}}const r=f(),x=f(+a.rows),m=R(()=>["plain","underlined"].includes(a.variant));Ee(()=>{a.autoGrow||(x.value=+a.rows)});function B(){a.autoGrow&&ne(()=>{if(!r.value||!U.value)return;const u=getComputedStyle(r.value),_=getComputedStyle(U.value.$el),v=parseFloat(u.getPropertyValue("--v-field-padding-top"))+parseFloat(u.getPropertyValue("--v-input-padding-top"))+parseFloat(u.getPropertyValue("--v-field-padding-bottom")),h=r.value.scrollHeight,N=parseFloat(u.lineHeight),W=Math.max(parseFloat(a.rows)*N+v,parseFloat(_.getPropertyValue("--v-input-control-height"))),X=parseFloat(a.maxRows)*N+v||1/0,n=Je(h??0,W,X);x.value=Math.floor((n-v)/N),Z.value=Ze(n)})}fe(B),K(d,B),K(()=>a.rows,B),K(()=>a.maxRows,B),K(()=>a.density,B);let w;return K(r,u=>{u?(w=new ResizeObserver(B),w.observe(r.value)):w==null||w.disconnect()}),Ne(()=>{w==null||w.disconnect()}),qe(()=>{const u=!!(c.counter||a.counter||a.counterValue),_=!!(u||c.details),[v,h]=Ae(C),{modelValue:N,...W}=ce.filterProps(a),X=Ge(a);return e(ce,Q({ref:Y,modelValue:d.value,"onUpdate:modelValue":n=>d.value=n,class:["v-textarea v-text-field",{"v-textarea--prefixed":a.prefix,"v-textarea--suffixed":a.suffix,"v-text-field--prefixed":a.prefix,"v-text-field--suffixed":a.suffix,"v-textarea--auto-grow":a.autoGrow,"v-textarea--no-resize":a.noResize||a.autoGrow,"v-input--plain-underlined":m.value},a.class],style:a.style},v,W,{centerAffix:x.value===1&&!m.value,focused:p.value}),{...c,default:n=>{let{id:l,isDisabled:t,isDirty:V,isReadonly:se,isValid:Ce}=n;return e(He,Q({ref:U,style:{"--v-textarea-control-height":Z.value},onClick:$,onMousedown:E,"onClick:clear":b,"onClick:prependInner":a["onClick:prependInner"],"onClick:appendInner":a["onClick:appendInner"]},X,{id:l.value,active:T.value||V.value,centerAffix:x.value===1&&!m.value,dirty:V.value||a.dirty,disabled:t.value,focused:p.value,error:Ce.value===!1}),{...c,default:Se=>{let{props:{class:ie,...de}}=Se;return e(ae,null,[a.prefix&&e("span",{class:"v-text-field__prefix"},[a.prefix]),re(e("textarea",Q({ref:y,class:ie,value:d.value,onInput:i,autofocus:a.autofocus,readonly:se.value,disabled:t.value,placeholder:a.placeholder,rows:a.rows,name:a.name,onFocus:F,onBlur:P},de,h),null),[[ze("intersect"),{handler:L},null,{once:!0}]]),a.autoGrow&&re(e("textarea",{class:[ie,"v-textarea__sizer"],id:`${de.id}-sizer`,"onUpdate:modelValue":Me=>d.value=Me,ref:r,readonly:!0,"aria-hidden":"true"},null),[[Oe,d.value]]),a.suffix&&e("span",{class:"v-text-field__suffix"},[a.suffix])])}})},details:_?n=>{var l;return e(ae,null,[(l=c.details)==null?void 0:l.call(c,n),u&&e(ae,null,[e("span",null,null),e(je,{active:a.persistentCounter||p.value,value:g.value,max:j.value},c.counter)])])}:void 0})}),Le({},Y,U,y)}});const pa=a=>(_e("data-v-aecc3f18"),a=a(),ye(),a),ga=pa(()=>I("div",{class:"text-h6 mx-2 my-3"},"診療紀錄",-1)),Va={class:"text-end mb-2"},ba={__name:"DescriptionDialog",emits:["update"],setup(a,{expose:H,emit:C}){const S=f(!1),c=f(""),d=f(!1),p=f(null),M=ge(),{api:P}=xe(),g=Ve(),j=We(),L=C,{handleSubmit:Y,isSubmitting:U,resetForm:Z}=we({validationSchema:{description:O().required("描述為必填欄位")}}),y=q("description"),T=b=>{b?(c.value=b._id,p.value=new Date(b.date),y.value.value=b.description):(c.value="",p.value=new Date),S.value=!0},F=()=>{S.value=!1,p.value=new Date,Z({description:""})},$=R(()=>p.value?p.value.toLocaleDateString():null),E=Y(async b=>{var i,r;try{const x={date:$.value,description:b.description,edit_by:j.account+" "+j.position};c.value===""?await P.post("/pets/medical/"+g.params.id,x):await P.patch(`/pets/medical/${g.params.id}/${c.value}`,x),L("update"),S.value=!1;const m=c.value===""?"新增成功":"修改成功";M({text:m,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"success",location:"bottom"}})}catch(x){const m=((r=(i=x==null?void 0:x.response)==null?void 0:i.data)==null?void 0:r.message)||"發生錯誤，請稍後再試";M({text:m,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"error",location:"bottom"}})}});return H({openDialog:T}),(b,i)=>(J(),te(Ke,{width:800,modelValue:S.value,"onUpdate:modelValue":i[4]||(i[4]=r=>S.value=r),persistent:""},{default:o(()=>[e(oe,null,{default:o(()=>[e(he,{disabled:s(U),onSubmit:be(s(E),["prevent"])},{default:o(()=>[e(le,null,{default:o(()=>[ga,e(De,{modelValue:d.value,"onUpdate:modelValue":i[2]||(i[2]=r=>d.value=r),"close-on-content-click":!1},{activator:o(({props:r})=>[e(k,Q({label:"診療日期","model-value":$.value,color:"teal",readonly:""},r),null,16,["model-value"])]),default:o(()=>[e(ke,{onInput:i[0]||(i[0]=r=>d.value=!1),modelValue:p.value,"onUpdate:modelValue":i[1]||(i[1]=r=>p.value=r),height:"430px",color:"teal"},null,8,["modelValue"])]),_:1},8,["modelValue"]),e(fa,{label:"描述",color:"teal",modelValue:s(y).value.value,"onUpdate:modelValue":i[3]||(i[3]=r=>s(y).value.value=r),"error-messages":s(y).errorMessage.value},null,8,["modelValue","error-messages"]),I("div",Va,[e(A,{disabled:s(U),variant:"text",onClick:F},{default:o(()=>[G("取消")]),_:1},8,["disabled"]),e(A,{type:"submit",color:"teal"},{default:o(()=>[G(Xe(c.value===""?"新增":"送出"),1)]),_:1})])]),_:1})]),_:1},8,["disabled","onSubmit"])]),_:1})]),_:1},8,["modelValue"]))}},xa=pe(ba,[["__scopeId","data-v-aecc3f18"]]);const ee=a=>(_e("data-v-b87090fe"),a=a(),ye(),a),_a=ee(()=>I("div",{class:"text-subtitle-1 font-weight-medium ms-2 mb-2"},"基本資訊",-1)),ya=ee(()=>I("div",{class:"text-subtitle-1 font-weight-medium mb-2 ms-2"},"照片",-1)),wa={class:"d-flex justify-space-between align-center"},ha=ee(()=>I("div",{class:"text-subtitle-1 font-weight-medium ms-2 mb-2"},"飼主資訊",-1)),Da={key:0,class:"text-end"},ka={class:"text-end"},Ca={class:"d-flex justify-space-between align-center"},Sa=ee(()=>I("div",{class:"text-subtitle-1 font-weight-medium ms-2 mb-2"},"診療紀錄",-1)),Ma=ee(()=>I("div",{class:"text-subtitle-1 font-weight-medium ms-2 mb-2"},"掛號紀錄",-1)),Fa={__name:"MedicalDetail",setup(a){const H=f(!1),C=f(!0),S=f(null),c=f(null),d=Ve(),p=Qe(),{api:M}=xe(),P=ge(),g=ea(),{sm:j}=aa(),L=R(()=>j.value),Y=()=>{p.go(-1)},U=sa({name:O().required("姓名為必填欄位"),species:O().required("種族為必填欄位"),breed:O().required("品種為必填欄位"),gender:O().required("性別為必填欄位"),weight:na().required("體重為必填欄位"),personality:O().required("性格為必填欄位"),chip_id:O().required("晶片號碼為必填欄位").matches(/^.{4}-.{4}-.{4}-.{4}$/,"晶片號碼格式錯誤")}),{handleSubmit:Z,isSubmitting:y}=we({validationSchema:U}),T=q("name"),F=q("species"),$=q("breed"),E=q("gender"),b=q("weight"),i=q("personality"),r=q("chip_id"),x=f(null),m=f(null),B=f([]);fe(async()=>{var n,l;try{const{data:t}=await M.get(`/pets/${d.params.id}`);console.log(t.result),T.value.value=t.result.name,F.value.value=t.result.species,$.value.value=t.result.breed,E.value.value=t.result.gender,b.value.value=t.result.weight,m.value=new Date(t.result.birth),t.result.personality?i.value.value=t.result.personality:i.value.value="",r.value.value=t.result.chip_id.replace(/-/g,""),x.value=t.result.image;const{data:V}=await M.get(`/users/${t.result.owner}`);g.login(V.result)}catch(t){console.log(t);const V=((l=(n=t==null?void 0:t.response)==null?void 0:n.data)==null?void 0:l.message)||"發生錯誤，請稍後再試";P({text:V,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}});const w=R(()=>{if(m.value){const n=new Date,l=new Date(m.value);let t=n.getFullYear()-l.getFullYear();const V=n.getMonth()-l.getMonth();return(V<0||V===0&&n.getDate()<l.getDate())&&t--,t}return null}),u=R(()=>{if(m.value){const n=new Date,l=new Date(m.value);let t=n.getMonth()-l.getMonth();return(t<0||t===0&&n.getDate()<l.getDate())&&(t=t+12),t}return null}),_=R(()=>m.value?m.value.toLocaleDateString():null),v=n=>{c.value.openDialog(n)},h=[{title:"日期",key:"date"},{title:"描述",key:"description",sortable:!1},{title:"主治醫生",key:"edit_by"},{title:"編輯 / 刪除",key:"actions",align:"center",sortable:!1}],N=async()=>{try{C.value=!0;const{data:n}=await M.get("/pets/medical/"+d.params.id);B.value=n.result.descriptions}catch(n){console.log(n)}C.value=!1};N();const W=Z(async n=>{var l,t;try{g._id!==null&&(n.owner=g._id),n.birth=_.value,await M.patch("/pets/"+d.params.id,n),P({text:"更新成功",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"success",location:"bottom"}})}catch(V){const se=((t=(l=V==null?void 0:V.response)==null?void 0:l.data)==null?void 0:t.message)||"發生錯誤，請稍後再試";P({text:se,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}}),X=async n=>{try{await M.delete("/pets/medical/"+d.params.id+"/"+n._id),P({text:"刪除成功",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"success",location:"bottom"}}),N()}catch(l){console.log(l)}};return(n,l)=>(J(),me(ae,null,[e(A,{variant:"text",class:"ms-4","prepend-icon":"mdi-arrow-left",onClick:Y},{default:o(()=>[G("返回")]),_:1}),e(ia,null,{default:o(()=>[e(he,{disabled:s(y),onSubmit:be(s(W),["prevent"])},{default:o(()=>[e(oe,{class:"mb-3"},{default:o(()=>[e(da,null,{default:o(()=>[e(ta,{class:"ms-4"},{default:o(()=>[G("mdi-paw")]),_:1}),e(ca,{class:"ms-2"},{default:o(()=>[G("編輯寵物病歷")]),_:1})]),_:1}),e(le,null,{default:o(()=>[e(z,null,{default:o(()=>[e(D,{cols:"12",md:"8",class:"pb-0"},{default:o(()=>[_a,e(z,null,{default:o(()=>[e(D,{cols:"12",md:"6"},{default:o(()=>[e(k,{label:"姓名",color:"teal",modelValue:s(T).value.value,"onUpdate:modelValue":l[0]||(l[0]=t=>s(T).value.value=t),"error-messages":s(T).errorMessage.value},null,8,["modelValue","error-messages"]),e(ue,{label:"種族",items:["犬","貓","兔","鼠","鳥","兩棲","其他"],color:"teal",modelValue:s(F).value.value,"onUpdate:modelValue":l[1]||(l[1]=t=>s(F).value.value=t),"error-messages":s(F).errorMessage.value},null,8,["modelValue","error-messages"]),e(k,{label:"品種",color:"teal",modelValue:s($).value.value,"onUpdate:modelValue":l[2]||(l[2]=t=>s($).value.value=t),"error-messages":s($).errorMessage.value},null,8,["modelValue","error-messages"]),ya,e(la,{"max-height":"176",src:x.value,"aspect-ratio":"4/3",class:"bg-grey-lighten-3"},null,8,["src"])]),_:1}),e(D,{cols:"12",md:"6"},{default:o(()=>[e(ue,{label:"性別",items:["公","母"],color:"teal",modelValue:s(E).value.value,"onUpdate:modelValue":l[3]||(l[3]=t=>s(E).value.value=t),"error-messages":s(E).errorMessage.value},null,8,["modelValue","error-messages"]),e(k,{label:"體重",type:"string","model-value":"0",suffix:"(g)",color:"teal",modelValue:s(b).value.value,"onUpdate:modelValue":l[4]||(l[4]=t=>s(b).value.value=t),"error-messages":s(b).errorMessage.value},null,8,["modelValue","error-messages"]),e(ue,{label:"性格",items:["溫和","緊張","危險"],color:"teal",modelValue:s(i).value.value,"onUpdate:modelValue":l[5]||(l[5]=t=>s(i).value.value=t),"error-messages":s(i).errorMessage.value},null,8,["modelValue","error-messages"]),e(De,{modelValue:H.value,"onUpdate:modelValue":l[8]||(l[8]=t=>H.value=t),"close-on-content-click":!1},{activator:o(({props:t})=>[e(k,Q({label:"出生日期","model-value":_.value,color:"teal",readonly:""},t),null,16,["model-value"])]),default:o(()=>[e(ke,{"onUpdate:modelValue":[l[6]||(l[6]=t=>H.value=!1),l[7]||(l[7]=t=>m.value=t)],modelValue:m.value,color:"teal"},null,8,["modelValue"])]),_:1},8,["modelValue"]),e(z,null,{default:o(()=>[e(D,{cols:"6"},{default:o(()=>[e(k,{label:"年齡",modelValue:w.value,"onUpdate:modelValue":l[9]||(l[9]=t=>w.value=t),suffix:"(歲)",color:"teal",readonly:""},null,8,["modelValue"])]),_:1}),e(D,{cols:"6"},{default:o(()=>[e(k,{label:"月份",modelValue:u.value,"onUpdate:modelValue":l[10]||(l[10]=t=>u.value=t),suffix:"(月)",color:"teal",readonly:""},null,8,["modelValue"])]),_:1})]),_:1}),re(e(k,{label:"晶片號碼",color:"teal",modelValue:s(r).value.value,"onUpdate:modelValue":l[11]||(l[11]=t=>s(r).value.value=t),"error-messages":s(r).errorMessage.value},null,8,["modelValue","error-messages"]),[[s(oa.mask),"####-####-####-####"]])]),_:1})]),_:1})]),_:1}),L.value?(J(),te(ve,{key:0,class:"mx-3"})):(J(),te(ve,{key:1,vertical:"",class:"my-3"})),e(D,{cols:"12",md:"4",class:"pb-0"},{default:o(()=>[e(z,null,{default:o(()=>[e(D,{cols:"12"},{default:o(()=>[I("div",wa,[ha,e(ua)]),e(k,{label:"姓名",color:"teal",modelValue:s(g).user_name,"onUpdate:modelValue":l[12]||(l[12]=t=>s(g).user_name=t),suffix:s(g).honorific,readonly:""},null,8,["modelValue","suffix"]),e(k,{label:"身分證字號",color:"teal",modelValue:s(g).national_id,"onUpdate:modelValue":l[13]||(l[13]=t=>s(g).national_id=t),readonly:""},null,8,["modelValue"]),e(k,{label:"電話",color:"teal",modelValue:s(g).phone,"onUpdate:modelValue":l[14]||(l[14]=t=>s(g).phone=t),readonly:""},null,8,["modelValue"])]),_:1})]),_:1}),L.value?(J(),me("div",Da,[e(A,{color:"teal",type:"submit",class:"mb-4"},{default:o(()=>[G("更新寵物病歷")]),_:1})])):(J(),te(z,{key:1,style:{height:"220px"}},{default:o(()=>[e(D,{cols:"12","align-self":"end"},{default:o(()=>[I("div",ka,[e(A,{color:"teal",type:"submit",flat:""},{default:o(()=>[G("更新寵物病歷")]),_:1})])]),_:1})]),_:1}))]),_:1})]),_:1})]),_:1})]),_:1}),e(z,null,{default:o(()=>[e(D,{cols:"12",md:"6"},{default:o(()=>[e(oe,null,{default:o(()=>[e(le,{class:"pb-0"},{default:o(()=>[e(z,null,{default:o(()=>[e(D,{cols:"12"},{default:o(()=>[I("div",Ca,[Sa,e(A,{color:"teal",density:"compact",variant:"text",class:"align-self-start",onClick:l[15]||(l[15]=t=>v(n.item))},{default:o(()=>[G("新增診療紀錄 ")]),_:1})]),e(ma,{headers:h,"sort-by":[{key:"date",order:"desc"}],items:B.value,loading:C.value,"items-per-page":10,"no-data-text":C.value?"載入中...":"無診療紀錄",color:"teal",class:"mb-4 elevation-1"},{"item.actions":o(({item:t})=>[e(A,{color:"teal",icon:"mdi-pencil",variant:"text",onClick:V=>v(t)},null,8,["onClick"]),e(A,{icon:"mdi-delete",variant:"text",color:"grey",onClick:V=>X(t)},null,8,["onClick"])]),_:2},1032,["items","loading","no-data-text"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(D,{cols:"12",md:"6"},{default:o(()=>[e(oe,null,{default:o(()=>[e(le,{class:"pb-0"},{default:o(()=>[Ma,e(ra,{id:s(d).params.id},null,8,["id"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["disabled","onSubmit"])]),_:1}),e(xa,{item:S.value,ref_key:"elDESCDialog",ref:c,onUpdate:N},null,8,["item"])],64))}},La=pe(Fa,[["__scopeId","data-v-b87090fe"]]);export{La as default};
