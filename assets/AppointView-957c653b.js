import{_ as R,r as n,a2 as G,a0 as H,a1 as J,c as z,o as K,ak as Q,a4 as u,a5 as m,ai as d,a8 as S,h as l,a7 as s,ab as O,aj as W,ag as X,a6 as C,aa as V,al as Y,i as Z,ac as ee,am as te,an as ae,ao as le,ap as se,ae as oe,ad as P,ah as A,V as ne}from"./index-fa1a0a70.js";import{V as re}from"./VForm-a77da8c3.js";import{V as ue}from"./VContainer-17c4b5bd.js";import{V as q}from"./VRow-a4ddde0f.js";import{V as b}from"./VCol-1420d651.js";import{V as F,a as ie}from"./VSelect-a23f0010.js";import{V as L}from"./VDatePicker-4f4daa7a.js";import"./VList-24642885.js";import"./VSheet-0025b386.js";const $=p=>(te("data-v-565d3d60"),p=p(),ae(),p),de={class:"overflow"},ce={key:0,class:"image-paw"},me=$(()=>d("div",{class:"circle-top"},null,-1)),pe=$(()=>d("div",{class:"circle-bottom"},null,-1)),ve={key:0,class:"ma-3 title"},fe={key:0,class:"d-flex justify-center align-center"},ge={class:"mx-5 my-6 text-center"},_e={class:"card-title my-3"},Ve={class:"card-subtitle"},be={__name:"AppointView",setup(p){const y=n(!1),w=n(),h=n([]),i=n(null),B=n([]),x=n(null),r=n(),U=n({required:a=>!!a||"此欄位為必填"}),{smAndUp:j}=G(),{api:c}=W(),k=H(),I=J(),v=z(()=>j.value);K(async()=>{try{const{data:a}=await c.get("/admins");h.value=a.result.filter(e=>e.position==="獸醫師").map(e=>({title:e.account,subtitle:e.position,value:e._id})),i.value=h.value[0].value}catch(a){console.log(a)}if(_(),!!k.isLogin)try{const{data:a}=await c.get("/pets/owner/"+k._id);B.value=a.result.map(e=>({title:e.name,subtitle:e.species,value:e._id}))}catch(a){console.log(a)}}),r.value=new Date;const f=z(()=>r.value?r.value.toLocaleDateString("en-CA"):null);w.value=a=>{const e=new Date(a).getDay();return e!==0&&e!==1};const E=z(()=>{const a=new Date(r.value).getDay();return a===5||a===6}),D=new Date().toISOString().substr(0,10),M=Q().addMonths(new Date(D),1),g=n([{title:"上午診",subtitle:"09:00 - 12:00",image:"https://github.com/sleepyhazzzel/vet-front/blob/main/src/assets/morning_icon.png?raw=true",text:"預約",full:!1},{title:"下午診",subtitle:"14:00 - 17:00",image:"https://github.com/sleepyhazzzel/vet-front/blob/main/src/assets/evening_icon.png?raw=true",text:"預約",full:!1},{title:"夜間診",subtitle:"18:00 - 21:00",image:"https://github.com/sleepyhazzzel/vet-front/blob/main/src/assets/night_icon.png?raw=true",text:"預約",full:!1}]),_=async()=>{try{const{data:a}=await c.get("/appointments/day",{params:{date:f.value,doctor:i.value}});console.log(a.result),a.result.forEach((e,t)=>{g.value[t].full=e,e?g.value[t].text="已額滿":g.value[t].text="預約"})}catch(a){console.log(a)}},T=async a=>{var e,t;try{const{data:o}=await c.get("/appointments/order",{params:{date:f.value,time:a,doctor:i.value}});await c.post("/appointments",{order:o.maxOrder+1},{params:{date:f.value,time:a,doctor:i.value,owner:k._id,pet:x.value}}),I({text:`掛號成功，預約編號：${o.maxOrder+1}`,showCloseButton:!0,snackbarProps:{color:"teal",location:"bottom"}})}catch(o){const N=((t=(e=o==null?void 0:o.response)==null?void 0:e.data)==null?void 0:t.message)||"發生錯誤，請稍後再試";I({text:N,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}};return(a,e)=>(u(),m(O,null,[d("div",de,[v.value?(u(),m("div",ce)):S("",!0),me,pe]),l(re,null,{default:s(()=>[l(ue,{style:X(v.value?"margin-top: 20vh;":"margin-top: 10vh;")},{default:s(()=>[l(q,null,{default:s(()=>[l(b,{cols:"12",sm:"7",class:"py-0"},{default:s(()=>[v.value?S("",!0):(u(),m("div",ve,"預約掛號")),l(q,{"no-gutters":""},{default:s(()=>[l(b,{cols:"12",sm:"6",class:"pe-sm-2"},{default:s(()=>[l(F,{label:"獸醫師",modelValue:i.value,"onUpdate:modelValue":[e[0]||(e[0]=t=>i.value=t),_],items:h.value,"item-props":!0,"item-title":"title","item-value":"value","prepend-inner-icon":"mdi-account",variant:"solo",color:"teal","bg-color":"rgba(255, 255, 255, 0.8)",rounded:"lg",flat:"",rules:[U.value.required]},null,8,["modelValue","items","rules"])]),_:1}),l(b,{cols:"12",sm:"6",class:"ps-sm-2"},{default:s(()=>[l(F,{label:"寵物",modelValue:x.value,"onUpdate:modelValue":e[1]||(e[1]=t=>x.value=t),items:B.value,"item-props":!0,"item-title":"title","item-value":"value","prepend-inner-icon":"mdi-paw",variant:"solo",color:"teal","bg-color":"rgba(255, 255, 255, 0.8)",rounded:"lg",flat:"","no-data-text":"請先註冊登入",rules:[U.value.required]},null,8,["modelValue","items","rules"])]),_:1})]),_:1}),v.value?(u(),C(L,{key:1,"hide-header":"",modelValue:r.value,"onUpdate:modelValue":[e[2]||(e[2]=t=>r.value=t),_],width:"100%",rounded:"lg",color:"teal",position:"relative","allowed-dates":w.value,min:V(D),max:V(M)},null,8,["modelValue","allowed-dates","min","max"])):(u(),C(ie,{key:2,modelValue:y.value,"onUpdate:modelValue":e[5]||(e[5]=t=>y.value=t),"close-on-content-click":!1},{activator:s(({props:t})=>[l(Y,Z({label:"日期","model-value":f.value,"prepend-inner-icon":"mdi-calendar",color:"teal",rounded:"lg",variant:"solo",readonly:"",flat:""},t),null,16,["model-value"])]),default:s(()=>[l(L,{"onUpdate:modelValue":[e[3]||(e[3]=t=>(y.value=!1,_)),e[4]||(e[4]=t=>r.value=t)],"allowed-dates":w.value,min:V(D),max:V(M),modelValue:r.value,color:"teal"},null,8,["allowed-dates","min","max","modelValue"])]),_:1},8,["modelValue"]))]),_:1}),l(b,{cols:"12",sm:"5",class:"py-0"},{default:s(()=>[(u(!0),m(O,null,ee(g.value,(t,o)=>(u(),C(le,{key:o,class:"mb-5",style:{background:"rgba(255, 255, 255, 0.8)"},rounded:"lg",flat:""},{default:s(()=>[E.value||o!==2?(u(),m("div",fe,[l(se,{class:"ma-3",size:"calc(60px + 5vw)",rounded:"0"},{default:s(()=>[l(oe,{src:t.image},null,8,["src"])]),_:2},1024),d("div",ge,[d("p",_e,[P(A(t.title)+" ",1),d("span",Ve,A(t.subtitle),1)]),l(ne,{disabled:t.full,block:"",variant:"tonal",color:"teal",rounded:"",flat:"",onClick:N=>T(t.title)},{default:s(()=>[P(A(t.text),1)]),_:2},1032,["disabled","onClick"])])])):S("",!0)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1},8,["style"])]),_:1})],64))}},Ae=R(be,[["__scopeId","data-v-565d3d60"]]);export{Ae as default};
