import{b5 as U,r as s,_ as L,a2 as N,a1 as R,$ as T,Z as F,c as D,o as z,a4 as q,a6 as S,a7 as l,aB as O,aM as Z,h as o,a8 as j,aC as E,i as G,V as b,a9 as H,ad as J}from"./index-928cbe6e.js";import{V as K}from"./VForm-f014e949.js";import{V as Q}from"./VRow-bc352195.js";import{V as d}from"./VCol-16c21398.js";import{b as W,a as h}from"./VSelect-85b188be.js";import{V as X}from"./VDatePicker-a280d4d2.js";import{V as Y}from"./VDataTable-03565d57.js";import{V as ee}from"./VContainer-c9bf44f0.js";import"./VList-396ce3d5.js";import"./VSheet-5b3ea164.js";const te=U("appointment",()=>{const v=s(""),n=s(""),u=s("");return{date:v,time:n,doctor:u,update:i=>{v.value=i.date,n.value=i.time,u.value=i.doctor}}},{persist:{key:"48763",paths:["token"]}});const ae={__name:"AppointData",setup(v){const n=s(null),u=s(!1),r=s(null),i=s([]),c=s(null),k=s({required:a=>!!a||"此欄位為必填"}),g=s([]),f=s(!1),{sm:A}=N(),{api:V}=Z(),w=R(),C=T(),m=F(),B=te(),x=D(()=>A.value);z(async()=>{n.value=m.query.date?new Date(m.query.date):null,r.value=m.query.time||null,c.value=m.query.doctor||null;try{const{data:a}=await V.get("/admins");i.value=a.result.filter(e=>e.position==="獸醫師").map(e=>({title:e.account,subtitle:e.position,value:e._id})),await y()}catch(a){console.log(a)}});const p=D(()=>n.value?n.value.toLocaleDateString("en-CA"):null),M=[{title:"掛號號碼",key:"order"},{title:"寵物",key:"pet_name"},{title:"種族",key:"pet_species"},{title:"品種",key:"pet_breed"},{title:"性格",key:"pet_personality"},{title:"檢視",key:"view",align:"center",sortable:!1},{title:"刪除",key:"delete",align:"center",sortable:!1}],y=async()=>{try{const a={date:p.value,time:r.value,doctor:c.value};f.value=!0;const{data:e}=await V.get("/appointments",{params:a});g.value=e.result}catch(a){console.log(a)}f.value=!1},$=async()=>{var a,e;try{const t={date:p.value,time:r.value,doctor:c.value};y(),B.update(t),C.replace({query:{date:p.value,time:r.value,doctor:c.value}})}catch(t){const _=((e=(a=t==null?void 0:t.response)==null?void 0:a.data)==null?void 0:e.message)||"發生錯誤，請稍後再試";w({text:_,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"error",location:"bottom"}})}},I=a=>{C.push(`/admin/appointment/${a.pet}`)},P=async a=>{await V.delete(`/appointments/${a._id}`),w({text:"刪除成功",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"success",location:"bottom"}}),y()};return(a,e)=>(q(),S(K,{onSubmit:O($,["prevent"])},{default:l(()=>[o(ee,null,{default:l(()=>[o(Q,null,{default:l(()=>[x.value?j("",!0):(q(),S(d,{key:0,cols:"12",md:"1"})),o(d,{cols:"12",md:"3"},{default:l(()=>[o(W,{modelValue:u.value,"onUpdate:modelValue":e[2]||(e[2]=t=>u.value=t),"close-on-content-click":!1},{activator:l(({props:t})=>[o(E,G({label:"日期","model-value":p.value,"prepend-inner-icon":"mdi-calendar",color:"teal","bg-color":"white",readonly:"",flat:""},t),null,16,["model-value"])]),default:l(()=>[o(X,{onInput:e[0]||(e[0]=t=>u.value=!1),modelValue:n.value,"onUpdate:modelValue":e[1]||(e[1]=t=>n.value=t),color:"teal"},null,8,["modelValue"])]),_:1},8,["modelValue"])]),_:1}),o(d,{cols:"12",md:"3"},{default:l(()=>[o(h,{label:"時段",modelValue:r.value,"onUpdate:modelValue":e[3]||(e[3]=t=>r.value=t),"prepend-inner-icon":"mdi-clock-time-four-outline",items:["上午診","下午診","夜間診"],color:"teal","bg-color":"white",rules:[k.value.required]},null,8,["modelValue","rules"])]),_:1}),o(d,{cols:"12",md:"3"},{default:l(()=>[o(h,{label:"獸醫師",modelValue:c.value,"onUpdate:modelValue":e[4]||(e[4]=t=>c.value=t),items:i.value,"item-props":!0,"item-title":"title","item-value":"value",color:"teal","bg-color":"white",rules:[k.value.required]},null,8,["modelValue","items","rules"])]),_:1}),o(d,{cols:"12",md:"2"},{default:l(()=>[o(b,{type:"submit","prepend-icon":"mdi-magnify",color:"teal",class:H(x.value?"":"mt-3")},{default:l(()=>[J("搜尋")]),_:1},8,["class"])]),_:1})]),_:1}),o(Y,{headers:M,items:g.value,"items-per-page":10,loading:f.value,"no-data-text":"請先選擇日期、時段、獸醫師並搜尋"},{"item.view":l(({item:t})=>[o(b,{icon:"mdi-eye",color:"teal",variant:"text",onClick:_=>I(t)},null,8,["onClick"])]),"item.delete":l(({item:t})=>[o(b,{icon:"mdi-delete",color:"grey",variant:"text",onClick:_=>P(t)},null,8,["onClick"])]),_:2},1032,["items","loading"])]),_:1})]),_:1}))}},pe=L(ae,[["__scopeId","data-v-c3d03987"]]);export{pe as default};
