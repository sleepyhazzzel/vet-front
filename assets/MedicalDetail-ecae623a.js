import{p as Fe,aY as Ie,aZ as Pe,g as Ue,a_ as $e,u as Be,a$ as Re,c as R,r as f,s as Te,j as Ee,o as fe,w as W,b as Ne,f as Ae,b0 as qe,b1 as ce,b2 as Ge,h as e,b3 as He,i as X,a8 as te,G as re,ay as ze,b4 as Oe,b5 as je,aG as Le,aE as ne,b6 as Ye,U as Ze,a as Je,_ as pe,a0 as ge,b7 as be,aN as Ke,a3 as J,a5 as ae,a6 as o,aa as s,ar as Ve,al as le,an as D,ag as I,V as q,ab as G,af as Qe,ak as oe,at as We,au as xe,ah as _e,ai as ye,Z as Xe,$ as et,a1 as tt,a4 as me,J as at,ac as lt}from"./index-716b94b4.js";import{v as ot}from"./vue-the-mask-8a7f8734.js";import{u as we,a as O,d as A,c as st,e as nt}from"./index.esm-2a0ad7ba.js";import{_ as ut}from"./SearchDialog-3b15ecc0.js";import{V as he}from"./VForm-344175e2.js";import{a as ke,V as ue}from"./VSelect-86733520.js";import{V as De}from"./VDatePicker-ec733ce0.js";import{_ as rt}from"./AppointTable-25a64e7b.js";import{V as it}from"./VContainer-9b68f997.js";import{V as dt,b as ct}from"./VToolbar-86867a65.js";import{V as z}from"./VRow-210547fd.js";import{V as k}from"./VCol-9539db28.js";import{V as mt}from"./VDataTable-5b808784.js";import{c as ve}from"./VList-2751bc00.js";import"./index-9f3434c9.js";import"./VSheet-bcee0fe5.js";const vt=Fe({autoGrow:Boolean,autofocus:Boolean,counter:[Boolean,Number,String],counterValue:Function,prefix:String,placeholder:String,persistentPlaceholder:Boolean,persistentCounter:Boolean,noResize:Boolean,rows:{type:[Number,String],default:5,validator:t=>!isNaN(parseFloat(t))},maxRows:{type:[Number,String],validator:t=>!isNaN(parseFloat(t))},suffix:String,modelModifiers:Object,...Ie(),...Pe()},"VTextarea"),ft=Ue()({name:"VTextarea",directives:{Intersect:$e},inheritAttrs:!1,props:vt(),emits:{"click:control":t=>!0,"mousedown:control":t=>!0,"update:focused":t=>!0,"update:modelValue":t=>!0},setup(t,H){let{attrs:C,emit:S,slots:c}=H;const d=Be(t,"modelValue"),{isFocused:p,focus:M,blur:P}=Re(t),g=R(()=>typeof t.counterValue=="function"?t.counterValue(d.value):(d.value||"").toString().length),j=R(()=>{if(C.maxlength)return C.maxlength;if(!(!t.counter||typeof t.counter!="number"&&typeof t.counter!="string"))return t.counter});function L(u,_){var v,h;!t.autofocus||!u||(h=(v=_[0].target)==null?void 0:v.focus)==null||h.call(v)}const Y=f(),U=f(),Z=Te(""),y=f(),T=R(()=>t.persistentPlaceholder||p.value||t.active);function F(){var u;y.value!==document.activeElement&&((u=y.value)==null||u.focus()),p.value||M()}function $(u){F(),S("click:control",u)}function E(u){S("mousedown:control",u)}function V(u){u.stopPropagation(),F(),ne(()=>{d.value="",Ye(t["onClick:clear"],u)})}function i(u){var v;const _=u.target;if(d.value=_.value,(v=t.modelModifiers)!=null&&v.trim){const h=[_.selectionStart,_.selectionEnd];ne(()=>{_.selectionStart=h[0],_.selectionEnd=h[1]})}}const r=f(),x=f(+t.rows),m=R(()=>["plain","underlined"].includes(t.variant));Ee(()=>{t.autoGrow||(x.value=+t.rows)});function B(){t.autoGrow&&ne(()=>{if(!r.value||!U.value)return;const u=getComputedStyle(r.value),_=getComputedStyle(U.value.$el),v=parseFloat(u.getPropertyValue("--v-field-padding-top"))+parseFloat(u.getPropertyValue("--v-input-padding-top"))+parseFloat(u.getPropertyValue("--v-field-padding-bottom")),h=r.value.scrollHeight,N=parseFloat(u.lineHeight),K=Math.max(parseFloat(t.rows)*N+v,parseFloat(_.getPropertyValue("--v-input-control-height"))),Q=parseFloat(t.maxRows)*N+v||1/0,n=Je(h??0,K,Q);x.value=Math.floor((n-v)/N),Z.value=Ze(n)})}fe(B),W(d,B),W(()=>t.rows,B),W(()=>t.maxRows,B),W(()=>t.density,B);let w;return W(r,u=>{u?(w=new ResizeObserver(B),w.observe(r.value)):w==null||w.disconnect()}),Ne(()=>{w==null||w.disconnect()}),Ae(()=>{const u=!!(c.counter||t.counter||t.counterValue),_=!!(u||c.details),[v,h]=qe(C),{modelValue:N,...K}=ce.filterProps(t),Q=Ge(t);return e(ce,X({ref:Y,modelValue:d.value,"onUpdate:modelValue":n=>d.value=n,class:["v-textarea v-text-field",{"v-textarea--prefixed":t.prefix,"v-textarea--suffixed":t.suffix,"v-text-field--prefixed":t.prefix,"v-text-field--suffixed":t.suffix,"v-textarea--auto-grow":t.autoGrow,"v-textarea--no-resize":t.noResize||t.autoGrow,"v-input--plain-underlined":m.value},t.class],style:t.style},v,K,{centerAffix:x.value===1&&!m.value,focused:p.value}),{...c,default:n=>{let{id:l,isDisabled:a,isDirty:b,isReadonly:se,isValid:Ce}=n;return e(He,X({ref:U,style:{"--v-textarea-control-height":Z.value},onClick:$,onMousedown:E,"onClick:clear":V,"onClick:prependInner":t["onClick:prependInner"],"onClick:appendInner":t["onClick:appendInner"]},Q,{id:l.value,active:T.value||b.value,centerAffix:x.value===1&&!m.value,dirty:b.value||t.dirty,disabled:a.value,focused:p.value,error:Ce.value===!1}),{...c,default:Se=>{let{props:{class:ie,...de}}=Se;return e(te,null,[t.prefix&&e("span",{class:"v-text-field__prefix"},[t.prefix]),re(e("textarea",X({ref:y,class:ie,value:d.value,onInput:i,autofocus:t.autofocus,readonly:se.value,disabled:a.value,placeholder:t.placeholder,rows:t.rows,name:t.name,onFocus:F,onBlur:P},de,h),null),[[ze("intersect"),{handler:L},null,{once:!0}]]),t.autoGrow&&re(e("textarea",{class:[ie,"v-textarea__sizer"],id:`${de.id}-sizer`,"onUpdate:modelValue":Me=>d.value=Me,ref:r,readonly:!0,"aria-hidden":"true"},null),[[Oe,d.value]]),t.suffix&&e("span",{class:"v-text-field__suffix"},[t.suffix])])}})},details:_?n=>{var l;return e(te,null,[(l=c.details)==null?void 0:l.call(c,n),u&&e(te,null,[e("span",null,null),e(je,{active:t.persistentCounter||p.value,value:g.value,max:j.value},c.counter)])])}:void 0})}),Le({},Y,U,y)}});const pt=t=>(_e("data-v-aecc3f18"),t=t(),ye(),t),gt=pt(()=>I("div",{class:"text-h6 mx-2 my-3"},"診療紀錄",-1)),bt={class:"text-end mb-2"},Vt={__name:"DescriptionDialog",emits:["update"],setup(t,{expose:H,emit:C}){const S=f(!1),c=f(""),d=f(!1),p=f(null),M=ge(),{api:P}=xe(),g=be(),j=Ke(),L=C,{handleSubmit:Y,isSubmitting:U,resetForm:Z}=we({validationSchema:{description:O().required("描述為必填欄位")}}),y=A("description"),T=V=>{V?(c.value=V._id,p.value=new Date(V.date),y.value.value=V.description):(c.value="",p.value=new Date),S.value=!0},F=()=>{S.value=!1,p.value=new Date,Z({description:""})},$=R(()=>p.value?p.value.toLocaleDateString():null),E=Y(async V=>{var i,r;try{const x={date:$.value,description:V.description,edit_by:j.account+" "+j.position};c.value===""?await P.post("/pets/medical/"+g.params.id,x):await P.patch(`/pets/medical/${g.params.id}/${c.value}`,x),L("update"),S.value=!1;const m=c.value===""?"新增成功":"修改成功";M({text:m,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"success",location:"bottom"}})}catch(x){const m=((r=(i=x==null?void 0:x.response)==null?void 0:i.data)==null?void 0:r.message)||"發生錯誤，請稍後再試";M({text:m,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"error",location:"bottom"}})}});return H({openDialog:T}),(V,i)=>(J(),ae(We,{width:800,modelValue:S.value,"onUpdate:modelValue":i[4]||(i[4]=r=>S.value=r),persistent:""},{default:o(()=>[e(oe,null,{default:o(()=>[e(he,{disabled:s(U),onSubmit:Ve(s(E),["prevent"])},{default:o(()=>[e(le,null,{default:o(()=>[gt,e(ke,{modelValue:d.value,"onUpdate:modelValue":i[2]||(i[2]=r=>d.value=r),"close-on-content-click":!1},{activator:o(({props:r})=>[e(D,X({label:"診療日期","model-value":$.value,color:"teal",readonly:""},r),null,16,["model-value"])]),default:o(()=>[e(De,{onInput:i[0]||(i[0]=r=>d.value=!1),modelValue:p.value,"onUpdate:modelValue":i[1]||(i[1]=r=>p.value=r),height:"430px",color:"teal"},null,8,["modelValue"])]),_:1},8,["modelValue"]),e(ft,{label:"描述",color:"teal",modelValue:s(y).value.value,"onUpdate:modelValue":i[3]||(i[3]=r=>s(y).value.value=r),"error-messages":s(y).errorMessage.value},null,8,["modelValue","error-messages"]),I("div",bt,[e(q,{disabled:s(U),variant:"text",onClick:F},{default:o(()=>[G("取消")]),_:1},8,["disabled"]),e(q,{type:"submit",color:"teal"},{default:o(()=>[G(Qe(c.value===""?"新增":"送出"),1)]),_:1})])]),_:1})]),_:1},8,["disabled","onSubmit"])]),_:1})]),_:1},8,["modelValue"]))}},xt=pe(Vt,[["__scopeId","data-v-aecc3f18"]]);const ee=t=>(_e("data-v-b87090fe"),t=t(),ye(),t),_t=ee(()=>I("div",{class:"text-subtitle-1 font-weight-medium ms-2 mb-2"},"基本資訊",-1)),yt=ee(()=>I("div",{class:"text-subtitle-1 font-weight-medium mb-2 ms-2"},"照片",-1)),wt={class:"d-flex justify-space-between align-center"},ht=ee(()=>I("div",{class:"text-subtitle-1 font-weight-medium ms-2 mb-2"},"飼主資訊",-1)),kt={key:0,class:"text-end"},Dt={class:"text-end"},Ct={class:"d-flex justify-space-between align-center"},St=ee(()=>I("div",{class:"text-subtitle-1 font-weight-medium ms-2 mb-2"},"診療紀錄",-1)),Mt=ee(()=>I("div",{class:"text-subtitle-1 font-weight-medium ms-2 mb-2"},"掛號紀錄",-1)),Ft={__name:"MedicalDetail",setup(t){const H=f(!1),C=f(!0),S=f(null),c=f(null),d=be(),p=Xe(),{api:M}=xe(),P=ge(),g=et(),{sm:j}=tt(),L=R(()=>j.value),Y=()=>{p.go(-1)},U=st({name:O().required("姓名為必填欄位"),species:O().required("種族為必填欄位"),breed:O().required("品種為必填欄位"),gender:O().required("性別為必填欄位"),weight:nt().required("體重為必填欄位"),personality:O().required("性格為必填欄位"),chip_id:O().required("晶片號碼為必填欄位").matches(/^.{4}-.{4}-.{4}-.{4}$/,"晶片號碼格式錯誤")}),{handleSubmit:Z,isSubmitting:y}=we({validationSchema:U}),T=A("name"),F=A("species"),$=A("breed"),E=A("gender"),V=A("weight"),i=A("personality"),r=A("chip_id"),x=f(null),m=f(null),B=f([]);fe(async()=>{var n,l;try{const{data:a}=await M.get(`/pets/${d.params.id}`);console.log(a.result),T.value.value=a.result.name,F.value.value=a.result.species,$.value.value=a.result.breed,E.value.value=a.result.gender,V.value.value=a.result.weight,m.value=new Date(a.result.birth),a.result.personality?i.value.value=a.result.personality:i.value.value="",r.value.value=a.result.chip_id.replace(/-/g,""),x.value=a.result.image;const{data:b}=await M.get(`/users/${a.result.owner}`);g.login(b.result)}catch(a){console.log(a);const b=((l=(n=a==null?void 0:a.response)==null?void 0:n.data)==null?void 0:l.message)||"發生錯誤，請稍後再試";P({text:b,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}});const w=R(()=>{if(m.value){const n=new Date,l=new Date(m.value);let a=n.getFullYear()-l.getFullYear();const b=n.getMonth()-l.getMonth();return(b<0||b===0&&n.getDate()<l.getDate())&&a--,a}return null}),u=R(()=>{if(m.value){const n=new Date,l=new Date(m.value);let a=n.getMonth()-l.getMonth();return(a<0||a===0&&n.getDate()<l.getDate())&&(a=a+12),a}return null}),_=R(()=>m.value?m.value.toLocaleDateString():null),v=n=>{c.value.openDialog(n)},h=[{title:"日期",key:"date"},{title:"描述",key:"description",sortable:!1},{title:"主治醫生",key:"edit_by"},{title:"編輯 / 刪除",key:"actions",align:"center",sortable:!1}],N=async()=>{try{C.value=!0;const{data:n}=await M.get("/pets/medical/"+d.params.id);B.value=n.result.descriptions}catch(n){console.log(n)}C.value=!1};N();const K=Z(async n=>{var l,a;try{g._id!==null&&(n.owner=g._id),n.birth=_.value,await M.patch("/pets/"+d.params.id,n),P({text:"更新成功",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"success",location:"bottom"}})}catch(b){const se=((a=(l=b==null?void 0:b.response)==null?void 0:l.data)==null?void 0:a.message)||"發生錯誤，請稍後再試";P({text:se,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}}),Q=async n=>{try{await M.delete("/pets/medical/"+d.params.id+"/"+n._id),P({text:"刪除成功",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"success",location:"bottom"}}),N()}catch(l){console.log(l)}};return(n,l)=>(J(),me(te,null,[e(q,{variant:"text",class:"ms-4","prepend-icon":"mdi-arrow-left",onClick:Y},{default:o(()=>[G("返回")]),_:1}),e(it,null,{default:o(()=>[e(he,{disabled:s(y),onSubmit:Ve(s(K),["prevent"])},{default:o(()=>[e(oe,{class:"mb-3"},{default:o(()=>[e(dt,null,{default:o(()=>[e(at,{class:"ms-4"},{default:o(()=>[G("mdi-paw")]),_:1}),e(ct,{class:"ms-2"},{default:o(()=>[G("編輯寵物病歷")]),_:1})]),_:1}),e(le,null,{default:o(()=>[e(z,null,{default:o(()=>[e(k,{cols:"12",md:"8",class:"pb-0"},{default:o(()=>[_t,e(z,null,{default:o(()=>[e(k,{cols:"12",md:"6"},{default:o(()=>[e(D,{label:"姓名",color:"teal",modelValue:s(T).value.value,"onUpdate:modelValue":l[0]||(l[0]=a=>s(T).value.value=a),"error-messages":s(T).errorMessage.value},null,8,["modelValue","error-messages"]),e(ue,{label:"種族",items:["犬","貓","兔","鼠","鳥","兩棲","其他"],color:"teal",modelValue:s(F).value.value,"onUpdate:modelValue":l[1]||(l[1]=a=>s(F).value.value=a),"error-messages":s(F).errorMessage.value},null,8,["modelValue","error-messages"]),e(D,{label:"品種",color:"teal",modelValue:s($).value.value,"onUpdate:modelValue":l[2]||(l[2]=a=>s($).value.value=a),"error-messages":s($).errorMessage.value},null,8,["modelValue","error-messages"]),yt,e(lt,{"max-height":"176",src:x.value,"aspect-ratio":"4/3",class:"bg-grey-lighten-3"},null,8,["src"])]),_:1}),e(k,{cols:"12",md:"6"},{default:o(()=>[e(ue,{label:"性別",items:["公","母"],color:"teal",modelValue:s(E).value.value,"onUpdate:modelValue":l[3]||(l[3]=a=>s(E).value.value=a),"error-messages":s(E).errorMessage.value},null,8,["modelValue","error-messages"]),e(D,{label:"體重",type:"string","model-value":"0",suffix:"(g)",color:"teal",modelValue:s(V).value.value,"onUpdate:modelValue":l[4]||(l[4]=a=>s(V).value.value=a),"error-messages":s(V).errorMessage.value},null,8,["modelValue","error-messages"]),e(ue,{label:"性格",items:["溫和","緊張","危險"],color:"teal",modelValue:s(i).value.value,"onUpdate:modelValue":l[5]||(l[5]=a=>s(i).value.value=a),"error-messages":s(i).errorMessage.value},null,8,["modelValue","error-messages"]),e(ke,{modelValue:H.value,"onUpdate:modelValue":l[8]||(l[8]=a=>H.value=a),"close-on-content-click":!1},{activator:o(({props:a})=>[e(D,X({label:"出生日期","model-value":_.value,color:"teal",readonly:""},a),null,16,["model-value"])]),default:o(()=>[e(De,{"onUpdate:modelValue":[l[6]||(l[6]=a=>H.value=!1),l[7]||(l[7]=a=>m.value=a)],modelValue:m.value,color:"teal"},null,8,["modelValue"])]),_:1},8,["modelValue"]),e(z,null,{default:o(()=>[e(k,{cols:"6"},{default:o(()=>[e(D,{label:"年齡",modelValue:w.value,"onUpdate:modelValue":l[9]||(l[9]=a=>w.value=a),suffix:"(歲)",color:"teal",readonly:""},null,8,["modelValue"])]),_:1}),e(k,{cols:"6"},{default:o(()=>[e(D,{label:"月份",modelValue:u.value,"onUpdate:modelValue":l[10]||(l[10]=a=>u.value=a),suffix:"(月)",color:"teal",readonly:""},null,8,["modelValue"])]),_:1})]),_:1}),re(e(D,{label:"晶片號碼",color:"teal",modelValue:s(r).value.value,"onUpdate:modelValue":l[11]||(l[11]=a=>s(r).value.value=a),"error-messages":s(r).errorMessage.value},null,8,["modelValue","error-messages"]),[[s(ot.mask),"####-####-####-####"]])]),_:1})]),_:1})]),_:1}),L.value?(J(),ae(ve,{key:0,class:"mx-3"})):(J(),ae(ve,{key:1,vertical:"",class:"my-3"})),e(k,{cols:"12",md:"4",class:"pb-0"},{default:o(()=>[e(z,null,{default:o(()=>[e(k,{cols:"12"},{default:o(()=>[I("div",wt,[ht,e(ut)]),e(D,{label:"姓名",color:"teal",modelValue:s(g).user_name,"onUpdate:modelValue":l[12]||(l[12]=a=>s(g).user_name=a),suffix:s(g).honorific,readonly:""},null,8,["modelValue","suffix"]),e(D,{label:"身分證字號",color:"teal",modelValue:s(g).national_id,"onUpdate:modelValue":l[13]||(l[13]=a=>s(g).national_id=a),readonly:""},null,8,["modelValue"]),e(D,{label:"電話",color:"teal",modelValue:s(g).phone,"onUpdate:modelValue":l[14]||(l[14]=a=>s(g).phone=a),readonly:""},null,8,["modelValue"])]),_:1})]),_:1}),L.value?(J(),me("div",kt,[e(q,{color:"teal",type:"submit",class:"mb-4"},{default:o(()=>[G("更新寵物病歷")]),_:1})])):(J(),ae(z,{key:1,style:{height:"220px"}},{default:o(()=>[e(k,{cols:"12","align-self":"end"},{default:o(()=>[I("div",Dt,[e(q,{color:"teal",type:"submit",flat:""},{default:o(()=>[G("更新寵物病歷")]),_:1})])]),_:1})]),_:1}))]),_:1})]),_:1})]),_:1})]),_:1}),e(z,null,{default:o(()=>[e(k,{cols:"12",md:"6"},{default:o(()=>[e(oe,null,{default:o(()=>[e(le,{class:"pb-0"},{default:o(()=>[e(z,null,{default:o(()=>[e(k,{cols:"12"},{default:o(()=>[I("div",Ct,[St,e(q,{color:"teal",density:"compact",variant:"text",class:"align-self-start",onClick:l[15]||(l[15]=a=>v(n.item))},{default:o(()=>[G("新增診療紀錄 ")]),_:1})]),e(mt,{headers:h,"sort-by":[{key:"date",order:"desc"}],items:B.value,loading:C.value,"items-per-page":10,"no-data-text":C.value?"載入中...":"無診療紀錄",color:"teal",class:"mb-4 elevation-1"},{"item.actions":o(({item:a})=>[e(q,{color:"teal",icon:"mdi-pencil",variant:"text",onClick:b=>v(a)},null,8,["onClick"]),e(q,{icon:"mdi-delete",variant:"text",color:"grey",onClick:b=>Q(a)},null,8,["onClick"])]),_:2},1032,["items","loading","no-data-text"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(k,{cols:"12",md:"6"},{default:o(()=>[e(oe,null,{default:o(()=>[e(le,{class:"pb-0"},{default:o(()=>[Mt,e(rt,{id:s(d).params.id},null,8,["id"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["disabled","onSubmit"])]),_:1}),e(xt,{item:S.value,ref_key:"elDESCDialog",ref:c,onUpdate:N},null,8,["item"])],64))}},Lt=pe(Ft,[["__scopeId","data-v-b87090fe"]]);export{Lt as default};
