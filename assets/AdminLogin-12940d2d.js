import{r as x,$ as _,a1 as S,aO as y,o as k,a4 as B,a6 as C,a7 as l,au as F,h as r,aa as a,ar as M,an as A,V as N,ad as $,ai as q}from"./index-c18772c7.js";import{c as P,a as d,u as T,d as p}from"./index.esm-5d3da9dc.js";import{V as U}from"./VContainer-d0e02daf.js";import{V as j}from"./VForm-9ae9dbf9.js";import{V as I}from"./VSelect-b633d929.js";import{V as L}from"./VSheet-4a502a03.js";import"./VList-e3a591b3.js";const O=q("h2",{class:"d-flex justify-center mb-3"},"管理員登入",-1),Q={__name:"AdminLogin",setup(R){const i=x([]),V=_(),c=S(),{api:m}=F(),f=y();k(async()=>{try{const{data:t}=await m.get("/admins");i.value=t.result.map(e=>({title:e.account,subtitle:e.position}))}catch(t){console.log(t)}});const b=P({account:d().required("帳號為必填欄位"),password:d().required("密碼為必填欄位").min(4,"密碼長度不符").max(20,"密碼長度不符")}),{handleSubmit:g,isSubmitting:h}=T({validationSchema:b}),n=p("account"),u=p("password"),v=g(async t=>{var e,s;try{const{data:o}=await m.post("/admins/login",{account:t.account,password:t.password});f.login(o.result),c({text:"登入成功",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"green",location:"bottom"}}),V.push("/admin/setting")}catch(o){console.log(o);const w=((s=(e=o==null?void 0:o.response)==null?void 0:e.data)==null?void 0:s.message)||"發生錯誤，請稍後再試";c({text:w,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}});return(t,e)=>(B(),C(U,null,{default:l(()=>[r(L,{class:"mx-auto pa-5","max-width":"500",elevation:"4"},{default:l(()=>[O,r(j,{disabled:a(h),onSubmit:M(a(v),["prevent"])},{default:l(()=>[r(I,{label:"帳號",items:i.value,"item-props":!0,modelValue:a(n).value.value,"onUpdate:modelValue":e[0]||(e[0]=s=>a(n).value.value=s),"error-messages":a(n).errorMessage.value},null,8,["items","modelValue","error-messages"]),r(A,{label:"密碼",type:"password",minlength:"4",maxlength:"20",counter:"",modelValue:a(u).value.value,"onUpdate:modelValue":e[1]||(e[1]=s=>a(u).value.value=s),"error-messages":a(u).errorMessage.value},null,8,["modelValue","error-messages"]),r(N,{type:"submit",color:"teal",block:""},{default:l(()=>[$("登入")]),_:1})]),_:1},8,["disabled","onSubmit"])]),_:1})]),_:1}))}};export{Q as default};
