import{r as w,a0 as le,a1 as te,o as Ve,a4 as V,a5 as F,h as e,a7 as a,ad as p,V as q,am as T,aa as t,ak as de,ap as Y,al as S,G as be,ai as u,aq as oe,ab as z,aj as se,c as P,a3 as he,i as xe,ar as ye,_ as ie,a6 as E,a8 as W,an as me,ao as ce,a2 as we,ag as ke,ah as M,ac as X,as as Z,a9 as ee,at as De,ae as Ue,J as Me}from"./index-d4ec24c3.js";import{c as pe,a as I,u as ve,d as $,e as Se}from"./index.esm-c705680a.js";import{v as ne,V as $e,b as Ce,a as Ae,c as Ie}from"./index-1c7e281a.js";import{d as Be}from"./index-465bd8ec.js";import{v as Fe}from"./vue-the-mask-579fda6b.js";import{V as fe}from"./VForm-8662b32e.js";import{V as L}from"./VRow-41a4f9a4.js";import{V as y}from"./VCol-8d4a0ece.js";import{V as ae,a as Te}from"./VSelect-575b63ba.js";import{V as qe}from"./VDatePicker-3378d49f.js";import{V as ze}from"./VDataTable-f5d357cf.js";import{V as Ee}from"./VContainer-9cbfca84.js";import{b as re,V as ue,a as Pe,c as R}from"./VList-f69f5da4.js";import{V as Le}from"./VSheet-e14ce167.js";const Ne=u("div",{class:"text-h6 mx-2 my-3"},"編輯使用者資料",-1),je={class:"text-end"},Re={__name:"EditUserDialog",setup(k){const i=w(!1),c=le(),B=te(),{apiAuth:b}=se(),C=()=>{i.value=!0},d=pe({user_name:I().required("必填"),honorific:I().required("必填"),national_id:I().required("必填").test("isNI","身分證格式錯誤",f=>Be.isNationalIdentificationNumberValid(f)),email:I().required("必填").test("isEmail","信箱格式錯誤",f=>ne.isEmail(f)),phone:I().required("必填").test("isPhone","手機號碼格式錯誤",f=>(f=f.replace(/-/g,""),ne.isMobilePhone(f,"zh-TW"))),address:I()}),{handleSubmit:g,isSubmitting:D}=ve({validationSchema:d}),U=$("user_name"),m=$("honorific"),n=$("national_id"),s=$("email"),r=$("phone"),h=$("address");Ve(()=>{U.value.value=c.user_name,m.value.value=c.honorific,n.value.value=c.national_id,s.value.value=c.email,r.value.value=c.phone,h.value.value=c.address});const N=g(async f=>{f.phone=f.phone.replace(/-/g,""),await b.patch(`/users/${c._id}`,f),c.login(f),B({text:"更新成功",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"success",location:"bottom"}})});return(f,v)=>(V(),F(z,null,[e(q,{"append-icon":"mdi-pencil",color:"teal",variant:"tonal",onClick:C},{default:a(()=>[p("編輯 ")]),_:1}),e(oe,{modelValue:i.value,"onUpdate:modelValue":v[6]||(v[6]=_=>i.value=_),width:500},{default:a(()=>[e(T,null,{default:a(()=>[e(fe,{disabled:t(D),onSubmit:de(t(N),["prevent"])},{default:a(()=>[e(Y,null,{default:a(()=>[Ne,e(L,{class:"py-3"},{default:a(()=>[e(y,{cols:"12",md:"6",class:"py-0"},{default:a(()=>[e(S,{label:"姓名",modelValue:t(U).value.value,"onUpdate:modelValue":v[0]||(v[0]=_=>t(U).value.value=_),"error-messages":t(U).errorMessage.value,color:"teal",variant:"solo-filled",flat:"",rounded:"lg"},null,8,["modelValue","error-messages"])]),_:1}),e(y,{cols:"12",md:"6",class:"py-0"},{default:a(()=>[e(ae,{label:"稱謂",items:["先生","女士"],color:"teal",variant:"solo-filled",flat:"",rounded:"lg",modelValue:t(m).value.value,"onUpdate:modelValue":v[1]||(v[1]=_=>t(m).value.value=_),"error-messages":t(m).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1})]),_:1}),e(S,{label:"身分證字號",color:"teal",variant:"solo-filled",flat:"",rounded:"lg",modelValue:t(n).value.value,"onUpdate:modelValue":v[2]||(v[2]=_=>t(n).value.value=_),"error-messages":t(n).errorMessage.value},null,8,["modelValue","error-messages"]),e(S,{label:"電子信箱",type:"email",color:"teal",variant:"solo-filled",flat:"",rounded:"lg",modelValue:t(s).value.value,"onUpdate:modelValue":v[3]||(v[3]=_=>t(s).value.value=_),"error-messages":t(s).errorMessage.value},null,8,["modelValue","error-messages"]),be(e(S,{label:"手機號碼",type:"tel",color:"teal",variant:"solo-filled",flat:"",rounded:"lg",modelValue:t(r).value.value,"onUpdate:modelValue":v[4]||(v[4]=_=>t(r).value.value=_),"error-messages":t(r).errorMessage.value},null,8,["modelValue","error-messages"]),[[t(Fe.mask),"####-###-###"]]),e(S,{label:"住址",color:"teal",variant:"solo-filled",flat:"",rounded:"lg",modelValue:t(h).value.value,"onUpdate:modelValue":v[5]||(v[5]=_=>t(h).value.value=_),"error-messages":t(h).errorMessage.value},null,8,["modelValue","error-messages"]),u("div",je,[e(q,{type:"submit",color:"teal",class:"mb-3"},{default:a(()=>[p("儲存")]),_:1})])]),_:1})]),_:1},8,["disabled","onSubmit"])]),_:1})]),_:1},8,["modelValue"])],64))}},We=u("div",{class:"text-h6 mx-2 my-3"},"新增寵物",-1),Ye=u("div",{class:"text-subtitle-1 font-weight-medium mt-4 ms-2 mb-2"},"照片",-1),Ge={class:"text-end"},Je={__name:"AddPet",emits:["update"],setup(k,{emit:i}){const c=le(),{apiAuth:B}=ye(),b=te(),C=i,d=w(!1),g=w(null),D=w(!1),U=w(null),m=w([]),n=w([]),s=P(()=>g.value?g.value.toLocaleDateString():null),r=P(()=>{if(g.value){const A=new Date,o=new Date(g.value);let x=A.getFullYear()-o.getFullYear();const l=A.getMonth()-o.getMonth();return(l<0||l===0&&A.getDate()<o.getDate())&&x--,x}return null}),h=P(()=>{if(g.value){const A=new Date,o=new Date(g.value);let x=A.getMonth()-o.getMonth();return(x<0||x===0&&A.getDate()<o.getDate())&&(x=x+12),x}return null}),N=pe({name:I().required("姓名為必填欄位"),species:I().required("種族為必填欄位"),breed:I().required("品種為必填欄位"),gender:I().required("性別為必填欄位"),weight:Se().typeError("商品價格格式錯誤").required("體重為必填欄位")}),{handleSubmit:f,isSubmitting:v,resetForm:_}=ve({validationSchema:N}),J=$("name"),O=$("species"),H=$("breed"),K=$("gender"),Q=$("weight"),_e=()=>{_(),d.value=!0},ge=f(async A=>{var o,x;try{const l=new FormData;for(const j in A)l.append(j,A[j]);m.value.length>0?l.append("image",m.value[0].file):l.append("image",null),l.append("birth",s.value),l.append("owner",c._id),l.append("chip_id",""),l.append("personality",""),await B.post("/pets",l),C("update"),b({text:"新增成功",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"success",location:"bottom"}}),d.value=!1}catch(l){const j=((x=(o=l==null?void 0:l.response)==null?void 0:o.data)==null?void 0:x.message)||"發生錯誤，請稍後再試";b({text:j,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"error",location:"bottom"}})}});return(A,o)=>{const x=he("VueFileAgent");return V(),F(z,null,[e(q,{color:"teal",variant:"tonal",class:"mt-1","append-icon":"mdi-plus-circle-outline",onClick:_e},{default:a(()=>[p("新增寵物 ")]),_:1}),e(oe,{modelValue:d.value,"onUpdate:modelValue":o[14]||(o[14]=l=>d.value=l),width:"800",persistent:""},{default:a(()=>[e(T,null,{default:a(()=>[e(fe,{disabled:t(v),onSubmit:de(t(ge),["prevent"])},{default:a(()=>[e(Y,null,{default:a(()=>[We,e(L,null,{default:a(()=>[e(y,{cols:"12",md:"6"},{default:a(()=>[e(S,{label:"姓名",color:"teal",modelValue:t(J).value.value,"onUpdate:modelValue":o[0]||(o[0]=l=>t(J).value.value=l),"error-messages":t(J).errorMessage.value},null,8,["modelValue","error-messages"]),e(S,{label:"體重",type:"string","model-value":"0",suffix:"(g)",color:"teal",modelValue:t(Q).value.value,"onUpdate:modelValue":o[1]||(o[1]=l=>t(Q).value.value=l),"error-messages":t(Q).errorMessage.value},null,8,["modelValue","error-messages"]),Ye,e(x,{modelValue:m.value,"onUpdate:modelValue":o[2]||(o[2]=l=>m.value=l),"raw-model-value":n.value,"onUpdate:rawModelValue":o[3]||(o[3]=l=>n.value=l),"error-text":{type:"檔案格式不支援",size:"檔案超過 1MB 大小限制"},accept:"image/jpeg,image/png",ref_key:"fileAgent",ref:U,"max-size":"1MB","max-files":1,deletable:""},null,8,["modelValue","raw-model-value"])]),_:1}),e(y,{cols:"12",md:"6"},{default:a(()=>[e(ae,{label:"性別",items:["公","母"],color:"teal",modelValue:t(K).value.value,"onUpdate:modelValue":o[4]||(o[4]=l=>t(K).value.value=l),"error-messages":t(K).errorMessage.value},null,8,["modelValue","error-messages"]),e(ae,{label:"種族",items:["犬","貓","兔","鼠","鳥","兩棲","其他"],color:"teal",modelValue:t(O).value.value,"onUpdate:modelValue":o[5]||(o[5]=l=>t(O).value.value=l),"error-messages":t(O).errorMessage.value},null,8,["modelValue","error-messages"]),e(S,{label:"品種",color:"teal",modelValue:t(H).value.value,"onUpdate:modelValue":o[6]||(o[6]=l=>t(H).value.value=l),"error-messages":t(H).errorMessage.value},null,8,["modelValue","error-messages"]),e(Te,{modelValue:D.value,"onUpdate:modelValue":o[10]||(o[10]=l=>D.value=l),"close-on-content-click":!1},{activator:a(({props:l})=>[e(S,xe({label:"出生日期","model-value":s.value,color:"teal",readonly:""},l),null,16,["model-value"])]),default:a(()=>[e(qe,{onInput:o[7]||(o[7]=l=>D.value=!1),modelValue:g.value,"onUpdate:modelValue":[o[8]||(o[8]=l=>g.value=l),o[9]||(o[9]=l=>D.value=!1)],color:"teal"},null,8,["modelValue"])]),_:1},8,["modelValue"]),e(L,null,{default:a(()=>[e(y,{cols:"6"},{default:a(()=>[e(S,{label:"年齡",modelValue:r.value,"onUpdate:modelValue":o[11]||(o[11]=l=>r.value=l),suffix:"(歲)",color:"teal",readonly:""},null,8,["modelValue"])]),_:1}),e(y,{cols:"6"},{default:a(()=>[e(S,{label:"月份",modelValue:h.value,"onUpdate:modelValue":o[12]||(o[12]=l=>h.value=l),suffix:"(月)",color:"teal",readonly:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),u("div",Ge,[e(q,{color:"teal",variant:"text",class:"me-3",onClick:o[13]||(o[13]=l=>d.value=!1)},{default:a(()=>[p("取消 ")]),_:1}),e(q,{color:"teal",loading:t(v),type:"submit"},{default:a(()=>[p("新增 ")]),_:1},8,["loading"])])]),_:1})]),_:1},8,["disabled","onSubmit"])]),_:1})]),_:1},8,["modelValue"])],64)}}};const Oe=k=>(me("data-v-24ac0810"),k=k(),ce(),k),He={class:"text-center"},Ke=Oe(()=>u("div",{class:"text-h6 mt-3 mb-8"},"確定取消預約掛號？",-1)),Qe={class:"mb-3"},Xe={__name:"AppointTable",props:{id:String},setup(k){const i=k,c=w(!1),B=w(!0),b=w(""),C=w([]),{apiAuth:d}=se(),g=te(),D=[{title:"日期",key:"date"},{title:"時段",key:"time"},{title:"獸醫師",key:"doctor_name"},{title:"號碼",key:"order"},{title:"取消",key:"actions",align:"center",sortable:!1}],U=async s=>{try{B.value=!0;const{data:r}=await d.get(`/appointments/${s}`);C.value=r.result}catch(r){console.log(r)}B.value=!1};U(i.id);const m=async s=>{c.value=!0,b.value=s._id},n=async()=>{try{c.value=!1,await d.delete(`/appointments/${b.value}`),U(i.id),g({text:"取消成功",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"success",location:"bottom"}})}catch(s){console.log(s)}};return(s,r)=>(V(),F(z,null,[e(ze,{headers:D,"sort-by":[{key:"date",order:"desc"}],items:C.value,"items-per-page":10,loading:B.value,"no-data-text":"無掛號紀錄"},{"item.actions":a(({item:h})=>[h.status?W("",!0):(V(),E(q,{key:0,color:"teal",variant:"text",onClick:N=>m(h)},{default:a(()=>[p("取消 ")]),_:2},1032,["onClick"]))]),_:2},1032,["items","loading"]),e(oe,{modelValue:c.value,"onUpdate:modelValue":r[1]||(r[1]=h=>c.value=h),"max-width":"300",persistent:""},{default:a(()=>[e(T,null,{default:a(()=>[e(Y,null,{default:a(()=>[u("div",He,[Ke,u("div",Qe,[e(q,{color:"teal",class:"me-3",variant:"text",onClick:r[0]||(r[0]=h=>c.value=!1)},{default:a(()=>[p("取消 ")]),_:1}),e(q,{color:"teal",onClick:n},{default:a(()=>[p("確定 ")]),_:1})])])]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}},Ze=ie(Xe,[["__scopeId","data-v-24ac0810"]]);const G=k=>(me("data-v-64e91b5a"),k=k(),ce(),k),ea=G(()=>u("div",{class:"bg"},null,-1)),aa={key:0,class:"ma-3 title"},la={class:"small-title"},ta={class:"d-flex justify-space-between"},oa={class:"d-flex flex-column flex-sm-row"},sa={class:"small-title"},na={class:"text-caption"},ra=G(()=>u("p",null,"體重",-1)),ua={class:"text-h6"},da=G(()=>u("p",null,"年齡",-1)),ia={class:"text-h6"},ma={class:"text-h6"},ca=G(()=>u("p",null,"出生日期",-1)),pa={class:"text-h6"},va={__name:"AccountView",setup(k){const i=le(),{api:c}=se(),{smAndUp:B}=we(),b=w(0),C=w([]),d=P(()=>B.value),g=P(()=>`https://source.boringavatars.com/beam/120/${encodeURIComponent(i.user_name)}?colors=545454,7B8A84,B2DFDB,EDE7D5,B7CC18`),D=async()=>{i.address||(i.address="尚未填寫");try{const{data:m}=await c.get(`/pets/owner/${i._id}`);if(!m.result)return;m.result.forEach(n=>{n.birth=new Date(n.birth).toLocaleDateString("zh-TW"),n.age=new Date().getFullYear()-new Date(n.birth).getFullYear(),n.month=new Date().getMonth()-new Date(n.birth).getMonth(),(n.month<0||n.month===0&&new Date().getDate()<new Date(n.birth).getDate())&&(n.age-=1,n.month+=12)}),C.value=m.result}catch(m){console.log(m)}};D();const U=P(()=>[{icon:"mdi-phone",text:i.phone},{icon:"mdi-card-account-details",text:i.national_id},{icon:"mdi-map-marker",text:i.address},{icon:"mdi-email",text:i.email}]);return(m,n)=>(V(),F(z,null,[ea,e(Ee,{style:ke(d.value?"margin-top: -11vh;":"margin-top: -20vh;")},{default:a(()=>[e(L,null,{default:a(()=>[e(y,{cols:"12",md:"10","offset-md":"1"},{default:a(()=>[d.value?W("",!0):(V(),F("div",aa,"個人帳號")),e(T,{class:"px-4 py-2"},{default:a(()=>[e(re,{class:"pb-0"},{default:a(()=>[e(ue,{"prepend-avatar":g.value,class:"pe-0"},{append:a(()=>[e(Re)]),default:a(()=>[e(Pe,null,{default:a(()=>[p(M(t(i).user_name)+" ",1),u("span",la," ("+M(t(i).honorific)+")",1)]),_:1})]),_:1},8,["prepend-avatar"])]),_:1}),e(R,{class:"my-1"}),u("div",null,[e(re,{class:"pa-0 d-flex flex-column flex-md-row justify-md-space-between overflow-hidden",disabled:""},{default:a(()=>[(V(!0),F(z,null,X(U.value,s=>(V(),E(ue,{key:s,"prepend-icon":s.icon},{default:a(()=>[p(M(s.text),1)]),_:2},1032,["prepend-icon"]))),128))]),_:1})])]),_:1})]),_:1}),e(y,{cols:"12",md:"10","offset-md":"1"},{default:a(()=>[e(T,{class:"pa-3"},{default:a(()=>[u("div",ta,[e(Z,{class:"card-title"},{default:a(()=>[p("寵物資料")]),_:1}),e(Je,{onUpdate:D})]),e(R,{class:"mt-1 mb-sm-3"}),u("div",oa,[e(L,null,{default:a(()=>[e(y,{cols:"12",sm:"2",class:ee(d.value?"":"mt-3 pb-0")},{default:a(()=>[e($e,{modelValue:b.value,"onUpdate:modelValue":n[0]||(n[0]=s=>b.value=s),direction:d.value?"vertical":"horizontal",color:"teal"},{default:a(()=>[(V(!0),F(z,null,X(C.value,(s,r)=>(V(),E(Ae,{key:r,value:r,class:ee(b.value===r?"tab-focus":""),rounded:d.value?"e":"t"},{default:a(()=>[p(M(s.name),1)]),_:2},1032,["value","class","rounded"]))),128))]),_:1},8,["modelValue","direction"])]),_:1},8,["class"]),e(y,{cols:"12",sm:"10",class:ee(d.value?"":"py-0")},{default:a(()=>[e(Ce,{modelValue:b.value,"onUpdate:modelValue":n[1]||(n[1]=s=>b.value=s),class:"pa-3 rounded bg-grey-lighten-2",touch:""},{default:a(()=>[(V(!0),F(z,null,X(C.value,(s,r)=>(V(),E(Ie,{key:r,value:r},{default:a(()=>[e(T,{class:"pa-3 mb-3"},{default:a(()=>[e(Z,{class:"card-title"},{default:a(()=>[p("基本資料")]),_:1}),e(T,{class:"mx-2",flat:""},{prepend:a(()=>[e(De,{size:d.value?"60":"40",class:"me-2"},{default:a(()=>[e(Ue,{src:s.image,cover:""},null,8,["src"])]),_:2},1032,["size"])]),title:a(()=>[p(M(s.name),1),u("span",sa," ("+M(s.species)+")",1)]),subtitle:a(()=>[u("p",na,"晶片號碼："+M(s.chip_id),1)]),append:a(()=>[e(Me,{icon:s.gender==="公"?"mdi-gender-male":"mdi-gender-female",color:"teal",size:"40"},null,8,["icon"])]),_:2},1024),e(Le,{class:"mx-2 mb-2 px-3 sheet",rounded:""},{default:a(()=>[e(Y,null,{default:a(()=>[e(L,null,{default:a(()=>[e(y,{cols:"12",sm:"4"},{default:a(()=>[ra,u("span",ua,M(s.weight),1),p("(g) ")]),_:2},1024),d.value?(V(),E(R,{key:0,color:"teal",vertical:""})):W("",!0),e(y,{cols:"12",sm:"4"},{default:a(()=>[da,u("span",ia,M(s.age),1),p(" 歲 "),u("span",ma,M(s.month),1),p(" 月 ")]),_:2},1024),d.value?(V(),E(R,{key:1,color:"teal",vertical:""})):W("",!0),e(y,{cols:"12",sm:"4"},{default:a(()=>[ca,u("span",pa,M(s.birth),1)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024),e(T,null,{default:a(()=>[e(Z,{class:"ma-3 card-title"},{default:a(()=>[p("掛號紀錄")]),_:1}),e(Ze,{id:s._id},null,8,["id"])]),_:2},1024)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["class"])]),_:1})])]),_:1})]),_:1})]),_:1})]),_:1},8,["style"])],64))}},$a=ie(va,[["__scopeId","data-v-64e91b5a"]]);export{$a as default};
