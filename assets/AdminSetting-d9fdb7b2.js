import{bb as oe,p as se,I as ne,l as ie,L as re,bd as ue,N as de,n as ce,be as me,q as ve,v as pe,x as be,bl as fe,g as ge,u as ye,c as L,X as Ve,bm as _e,Q as ke,bf as xe,R as Ce,E as Se,bg as he,A as we,C as Pe,t as Ae,B as $e,h as e,bn as Be,J as T,aK as Y,V,i as Te,r as C,a1 as N,a4 as b,a6 as f,a7 as l,aD as D,ad as B,bc as R,aH as O,aC as M,aa as s,ai as ae,a8 as Z,aB as j,aM as H,aL as Ie,o as Me,bo as ee,_ as Ue,af as qe}from"./index-928cbe6e.js";import{c as J,a as A,u as K,d as P,h as De}from"./index.esm-e13d856f.js";import{V as E,b as F}from"./VToolbar-8e3ab153.js";import{a as Q}from"./VSelect-85b188be.js";import{V as X}from"./VForm-f014e949.js";import{V as z}from"./VRow-bc352195.js";import{V as I}from"./VCol-16c21398.js";import{V as Ee}from"./VCheckbox-b5643276.js";import{V as Fe}from"./VContainer-c9bf44f0.js";import{V as Le}from"./VDataTable-03565d57.js";import"./VList-396ce3d5.js";const ze=oe("v-alert-title"),Ne=["success","info","warning","error"],Re=se({border:{type:[Boolean,String],validator:a=>typeof a=="boolean"||["top","end","bottom","start"].includes(a)},borderColor:String,closable:Boolean,closeIcon:{type:ne,default:"$close"},closeLabel:{type:String,default:"$vuetify.close"},icon:{type:[Boolean,String,Function,Object],default:null},modelValue:{type:Boolean,default:!0},prominent:Boolean,title:String,text:String,type:{type:String,validator:a=>Ne.includes(a)},...ie(),...re(),...ue(),...de(),...ce(),...me(),...ve(),...pe(),...be(),...fe({variant:"flat"})},"VAlert"),Oe=ge()({name:"VAlert",props:Re(),emits:{"click:close":a=>!0,"update:modelValue":a=>!0},setup(a,S){let{emit:u,slots:t}=S;const m=ye(a,"modelValue"),v=L(()=>{if(a.icon!==!1)return a.type?a.icon??`$${a.type}`:a.icon}),i=L(()=>({color:a.color??a.type,variant:a.variant})),{themeClasses:g}=Ve(a),{colorClasses:x,colorStyles:h,variantClasses:_}=_e(i),{densityClasses:k}=ke(a),{dimensionStyles:p}=xe(a),{elevationClasses:w}=Ce(a),{locationStyles:d}=Se(a),{positionClasses:o}=he(a),{roundedClasses:n}=we(a),{textColorClasses:c,textColorStyles:r}=Pe(Ae(a,"borderColor")),{t:y}=$e(),$=L(()=>({"aria-label":y(a.closeLabel),onClick(U){m.value=!1,u("click:close",U)}}));return()=>{const U=!!(t.prepend||v.value),te=!!(t.title||a.title),le=!!(t.close||a.closable);return m.value&&e(a.tag,{class:["v-alert",a.border&&{"v-alert--border":!!a.border,[`v-alert--border-${a.border===!0?"start":a.border}`]:!0},{"v-alert--prominent":a.prominent},g.value,x.value,k.value,w.value,o.value,n.value,_.value,a.class],style:[h.value,p.value,d.value,a.style],role:"alert"},{default:()=>{var G,W;return[Be(!1,"v-alert"),a.border&&e("div",{key:"border",class:["v-alert__border",c.value],style:r.value},null),U&&e("div",{key:"prepend",class:"v-alert__prepend"},[t.prepend?e(Y,{key:"prepend-defaults",disabled:!v.value,defaults:{VIcon:{density:a.density,icon:v.value,size:a.prominent?44:28}}},t.prepend):e(T,{key:"prepend-icon",density:a.density,icon:v.value,size:a.prominent?44:28},null)]),e("div",{class:"v-alert__content"},[te&&e(ze,{key:"title"},{default:()=>{var q;return[((q=t.title)==null?void 0:q.call(t))??a.title]}}),((G=t.text)==null?void 0:G.call(t))??a.text,(W=t.default)==null?void 0:W.call(t)]),t.append&&e("div",{key:"append",class:"v-alert__append"},[t.append()]),le&&e("div",{key:"close",class:"v-alert__close"},[t.close?e(Y,{key:"close-defaults",defaults:{VBtn:{icon:a.closeIcon,size:"x-small",variant:"text"}}},{default:()=>{var q;return[(q=t.close)==null?void 0:q.call(t,{props:$.value})]}}):e(V,Te({key:"close-btn",icon:a.closeIcon,size:"x-small",variant:"text"},$.value),null)])]}})}}}),Ze={class:"text-end"},je={__name:"AddAdmin",emits:["update"],setup(a,{emit:S}){const u=C(!1),t=C(!1),{api:m}=H(),v=N(),i=S,g=J({account:A().required("帳號為必填欄位").min(2,"使用者帳號過短").max(20,"使用者帳號過長").matches(/^.[A-Za-z0-9]+$/,"只能使用英數字",{excludeEmptyString:!0}),position:A().required("職稱為必填欄位"),password:A().required("密碼為必填欄位").min(4,"密碼長度過短").max(20,"密碼長度過長")}),{handleSubmit:x,isSubmitting:h}=K({validationSchema:g}),_=P("account"),k=P("position"),p=P("password"),w=x(async d=>{var o,n;try{await m.post("/admins",{account:d.account,position:d.position,password:d.password}),i("update"),v({text:"新增成功",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"success",location:"bottom"}})}catch(c){const r=((n=(o=c==null?void 0:c.response)==null?void 0:o.data)==null?void 0:n.message)||"發生錯誤，請稍後再試";v({text:r,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"error",location:"bottom"}})}});return(d,o)=>(b(),f(X,{disabled:s(h),onSubmit:j(s(w),["prevent"])},{default:l(()=>[e(D,{elevated:"6"},{default:l(()=>[e(E,null,{default:l(()=>[e(V,{icon:"mdi-account-plus"}),e(F,{class:"font-weight-light"},{default:l(()=>[B("新增管理員")]),_:1}),e(V,{icon:"",onClick:o[0]||(o[0]=n=>t.value=!t.value),class:"text-end"},{default:l(()=>[e(R,{"leave-absolute":""},{default:l(()=>[t.value?(b(),f(T,{key:0,icon:"mdi-close"})):(b(),f(T,{key:1,icon:"mdi-pencil"}))]),_:1})]),_:1})]),_:1}),t.value?(b(),f(O,{key:0},{default:l(()=>[e(M,{label:"管理員帳號",color:"teal",minlength:"2",maxlength:"20",counter:"",hint:"只能使用英數字，帳號長度 2 ~ 20 之間",modelValue:s(_).value.value,"onUpdate:modelValue":o[1]||(o[1]=n=>s(_).value.value=n),"error-messages":s(_).errorMessage.value},null,8,["modelValue","error-messages"]),e(Q,{label:"職稱",color:"teal",items:["獸醫師","護理師","助理"],modelValue:s(k).value.value,"onUpdate:modelValue":o[2]||(o[2]=n=>s(k).value.value=n),"errror-messages":s(k).errorMessage.value},null,8,["modelValue","errror-messages"]),e(M,{label:"密碼",color:"teal",type:u.value?"text":"password","append-inner-icon":u.value?"mdi-eye":"mdi-eye-off","onClick:appendInner":o[3]||(o[3]=n=>u.value=!u.value),minlength:"4",maxlength:"20",counter:"",hint:"密碼長度 4 ~ 20 之間",modelValue:s(p).value.value,"onUpdate:modelValue":o[4]||(o[4]=n=>s(p).value.value=n),"error-messages":s(p).errorMessage.value},null,8,["type","append-inner-icon","modelValue","error-messages"]),ae("div",Ze,[e(V,{type:"submit",color:"teal",class:"mb-1"},{default:l(()=>[B("新增管理員")]),_:1})])]),_:1})):Z("",!0)]),_:1})]),_:1},8,["disabled","onSubmit"]))}},He={class:"text-end"},Je={__name:"EditAdmin",emits:["update"],setup(a,{emit:S}){const u=C(!1),t=C(!1),{apiAuth:m}=H(),v=N(),i=Ie(),g=S,x=J({account:A().required("帳號為必填欄位").min(2,"使用者帳號過短").max(20,"使用者帳號過長").matches(/^.[A-Za-z0-9]+$/,"只能使用英數字",{excludeEmptyString:!0}),position:A().required("職稱為必填欄位"),password:A().required("密碼為必填欄位").min(4,"密碼長度過短").max(20,"密碼長度過長")}),{handleSubmit:h,isSubmitting:_,resetForm:k}=K({validationSchema:x,initialValues:{account:i.account,position:i.position}}),p=P("account"),w=P("position"),d=P("password"),o=()=>{k({values:{account:i.account,position:i.position}})},n=h(async c=>{var r,y;try{await m.patch("/admins/"+i._id,{account:c.account,position:c.position,password:c.password}),i.login({account:c.account,position:c.position,_id:i._id,token:i.token}),g("update"),v({text:"修改成功",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"success",location:"bottom"}})}catch($){console.log($);const U=((y=(r=$==null?void 0:$.response)==null?void 0:r.data)==null?void 0:y.message)||"發生錯誤，請稍後再試";v({text:U,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"error",location:"bottom"}})}});return(c,r)=>(b(),f(X,{disabled:s(_),onSubmit:j(s(n),["prevent"])},{default:l(()=>[e(D,{elevated:"6"},{default:l(()=>[e(E,null,{default:l(()=>[e(V,{icon:"mdi-account-edit"}),e(F,{class:"font-weight-light"},{default:l(()=>[B("修改管理員個人資料 ")]),_:1}),e(V,{icon:"",onClick:r[0]||(r[0]=y=>t.value=!t.value),class:"text-end"},{default:l(()=>[e(R,{"leave-absolute":""},{default:l(()=>[t.value?(b(),f(T,{key:0,icon:"mdi-close"})):(b(),f(T,{key:1,icon:"mdi-pencil"}))]),_:1})]),_:1})]),_:1}),t.value?(b(),f(O,{key:0},{default:l(()=>[e(M,{disabled:!t.value,label:"帳號",color:"teal",modelValue:s(p).value.value,"onUpdate:modelValue":r[1]||(r[1]=y=>s(p).value.value=y),"error-messages":s(p).errorMessage.value},null,8,["disabled","modelValue","error-messages"]),e(Q,{disabled:!t.value,items:["獸醫師","護理師","助理"],label:"職稱",color:"teal",modelValue:s(w).value.value,"onUpdate:modelValue":r[2]||(r[2]=y=>s(w).value.value=y),"errror-messages":s(w).errorMessage.value},null,8,["disabled","modelValue","errror-messages"]),e(M,{disabled:!t.value,label:"密碼",color:"teal",type:u.value?"text":"password","append-inner-icon":u.value?"mdi-eye":"mdi-eye-off","onClick:appendInner":r[3]||(r[3]=y=>u.value=!u.value),minlength:"6",maxlength:"20",counter:"",hint:"密碼長度：4 ~ 20 之間",modelValue:s(d).value.value,"onUpdate:modelValue":r[4]||(r[4]=y=>s(d).value.value=y),"error-messages":s(d).errorMessage.value},null,8,["disabled","type","append-inner-icon","modelValue","error-messages"]),ae("div",He,[e(V,{disabled:!t.value,onClick:o,color:"teal",variant:"text",class:"mb-1 me-2"},{default:l(()=>[B("重設 ")]),_:1},8,["disabled"]),e(V,{disabled:!t.value,type:"submit",color:"teal",class:"mb-1"},{default:l(()=>[B("確認 ")]),_:1},8,["disabled"])])]),_:1})):Z("",!0)]),_:1})]),_:1},8,["disabled","onSubmit"]))}},Ke={__name:"DeleteAdmin",emits:["delete"],setup(a,{emit:S}){const u=C([]),t=C(!1),m=C(!1),v=N(),i=S;Me(async()=>{try{const{data:d}=await ee.get("/admins");u.value=d.result.map(o=>({title:o.account,subtitle:o.position,value:o._id}))}catch(d){console.log(d)}});const g=J({account:A().required("帳號為必填"),password:A().required("密碼為必填"),checkbox:De().required("請勾選確認刪除")}),{handleSubmit:x,isSubmitting:h}=K({validationSchema:g}),_=P("account"),k=P("password"),p=P("checkbox"),w=x(async d=>{var o,n;try{await ee.delete("/admins/"+d.account,{password:d.password}),i("delete"),v({text:"刪除成功",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"success",location:"bottom"}})}catch(c){const r=((n=(o=c==null?void 0:c.response)==null?void 0:o.data)==null?void 0:n.message)||"發生錯誤，請稍後再試";v({text:r,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"error",location:"bottom"}})}});return(d,o)=>(b(),f(X,{disabled:s(h),onSubmit:j(s(w),["prevent"])},{default:l(()=>[e(D,{elevated:"6"},{default:l(()=>[e(E,null,{default:l(()=>[e(V,{icon:"mdi-account-minus"}),e(F,{class:"font-weight-light"},{default:l(()=>[B("刪除管理員 ")]),_:1}),e(V,{icon:"",onClick:o[0]||(o[0]=n=>t.value=!t.value),class:"text-end"},{default:l(()=>[e(R,{"leave-absolute":""},{default:l(()=>[t.value?(b(),f(T,{key:0,icon:"mdi-close"})):(b(),f(T,{key:1,icon:"mdi-pencil"}))]),_:1})]),_:1})]),_:1}),t.value?(b(),f(O,{key:0},{default:l(()=>[e(Oe,{variant:"tonal",color:"error",border:"start",icon:"mdi-alert-circle-outline",text:"刪除後無法復原，請謹慎操作",class:"mb-3"}),e(Q,{label:"帳號",items:u.value,"item-props":!0,"item-title":"title","item-value":"value",modelValue:s(_).value.value,"onUpdate:modelValue":o[1]||(o[1]=n=>s(_).value.value=n),"error-messages":s(_).errorMessage.value},null,8,["items","modelValue","error-messages"]),e(M,{label:"密碼",color:"teal",modelValue:s(k).value.value,"onUpdate:modelValue":o[2]||(o[2]=n=>s(k).value.value=n),"error-messages":s(k).errorMessage.value,type:m.value?"text":"password","append-inner-icon":m.value?"mdi-eye":"mdi-eye-off","onClick:appendInner":o[3]||(o[3]=n=>m.value=!m.value),hint:"請輸入已選擇管理員之密碼"},null,8,["modelValue","error-messages","type","append-inner-icon"]),e(z,null,{default:l(()=>[e(I,{class:"d-flex"},{default:l(()=>[e(Ee,{label:"確認刪除",color:"teal",density:"compact",modelValue:s(p).value.value,"onUpdate:modelValue":o[4]||(o[4]=n=>s(p).value.value=n),"error-messages":s(p).errorMessage.value},null,8,["modelValue","error-messages"]),e(V,{text:"刪除",color:"teal",class:"mt-1"})]),_:1})]),_:1})]),_:1})):Z("",!0)]),_:1})]),_:1},8,["disabled","onSubmit"]))}};const Qe={__name:"AdminSetting",setup(a){const{apiAuth:S}=H(),u=C(""),t=C([]),m=C(!0),v=[{title:"帳號",key:"account",align:"start"},{title:"職稱",key:"position",align:"start"},{title:"入職日期",key:"createdAt",align:"start"}],i=async()=>{try{m.value=!0;const{data:g}=await S.get("/admins");t.value=g.result}catch(g){console.log(g)}m.value=!1};return i(),(g,x)=>(b(),f(Fe,{class:"py-0"},{default:l(()=>[e(z,{class:"px-2"},{default:l(()=>[e(I,{cols:"12",md:"4"},{default:l(()=>[e(z,null,{default:l(()=>[e(I,{cols:"12"},{default:l(()=>[e(Je,{onUpdate:i})]),_:1}),e(I,{cols:"12"},{default:l(()=>[e(je,{onUpdate:i})]),_:1}),e(I,{cols:"12"},{default:l(()=>[e(Ke,{onDelete:i})]),_:1})]),_:1})]),_:1}),e(I,{cols:"12",md:"8"},{default:l(()=>[e(D,null,{default:l(()=>[e(Le,{headers:v,items:t.value,"items-per-page":10,loading:m.value,search:u.value},{top:l(()=>[e(E,{flat:""},{default:l(()=>[e(V,{icon:"mdi-account-multiple"}),e(F,{class:"font-weight-light"},{default:l(()=>[B("管理員列表")]),_:1}),e(qe),e(M,{label:"Search",modelValue:u.value,"onUpdate:modelValue":x[0]||(x[0]=h=>u.value=h),variant:"solo","append-inner-icon":"mdi-magnify",density:"compact",flat:"","single-line":"","hide-details":"",class:"me-3"},null,8,["modelValue"])]),_:1})]),_:1},8,["items","loading","search"])]),_:1})]),_:1})]),_:1})]),_:1}))}},ia=Ue(Qe,[["__scopeId","data-v-c54fe997"]]);export{ia as default};
